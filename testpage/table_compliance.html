<!DOCTYPE html>
<html lang="en">
<head>
    <title>Table Element Compliance Test (WHATWG 4.9.1)</title>
    <meta charset="UTF-8">
    <style>
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .info { color: blue; }
        .test-box { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
    </style>
</head>
<body>
    <h1>Table Element Compliance Test (WHATWG 4.9.1)</h1>

    <div id="results"></div>

    <h2>Visual Tests</h2>

    <h3>Test 1: Table with Caption</h3>
    <div class="test-box">
        <table id="test1">
            <caption>Employee Directory</caption>
            <tr>
                <th>Name</th>
                <th>Role</th>
            </tr>
            <tr>
                <td>Alice</td>
                <td>Developer</td>
            </tr>
        </table>
    </div>
    <p>Expected: "Employee Directory" caption centered above the table</p>

    <h3>Test 2: Table without Caption</h3>
    <div class="test-box">
        <table id="test2">
            <tr>
                <td>No caption here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no caption</p>

    <h3>Test 3: Table with Multiple Captions (only first valid)</h3>
    <div class="test-box">
        <table id="test3">
            <caption>First Caption</caption>
            <caption>Second Caption</caption>
            <tr>
                <td>Data</td>
            </tr>
        </table>
    </div>
    <p>Expected: Per spec, table.caption returns first caption child only</p>

    <h3>Test 4: Table with thead</h3>
    <div class="test-box">
        <table id="test4">
            <caption>Sales Report</caption>
            <thead>
                <tr>
                    <th>Quarter</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Q1</td>
                    <td>$10,000</td>
                </tr>
                <tr>
                    <td>Q2</td>
                    <td>$15,000</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: Table with caption "Sales Report" and a thead containing column headers</p>

    <h3>Test 5: Table without thead</h3>
    <div class="test-box">
        <table id="test5">
            <tr>
                <td>No thead here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no thead element</p>

    <h3>Test 6: Table with caption + colgroup + thead (insertion order test)</h3>
    <div class="test-box">
        <table id="test6">
            <caption>Inventory</caption>
            <colgroup>
                <col style="background-color: #f0f0f0">
                <col>
            </colgroup>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>42</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: Table with caption, colgroup, and thead in correct order</p>

    <h3>Test 7: Table with tfoot</h3>
    <div class="test-box">
        <table id="test7">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>$5.00</td>
                </tr>
                <tr>
                    <td>Gadget</td>
                    <td>$8.00</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td>Total</td>
                    <td>$13.00</td>
                </tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: Table with thead, tbody, and tfoot containing "Total $13.00"</p>

    <h3>Test 8: Table without tfoot</h3>
    <div class="test-box">
        <table id="test8">
            <tr>
                <td>No tfoot here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no tfoot element</p>

    <hr>

    <h2>JavaScript Tests - table.caption</h2>

    <script>
        var results = document.getElementById('results');

        function assert(condition, message) {
            var p = document.createElement('p');
            if (condition) {
                p.innerHTML = "PASS: " + message;
                p.classList.add('pass');
            } else {
                p.innerHTML = "FAIL: " + message;
                p.classList.add('fail');
            }
            results.appendChild(p);
        }

        function info(message) {
            var p = document.createElement('p');
            p.innerHTML = "INFO: " + message;
            p.classList.add('info');
            results.appendChild(p);
        }

        var table1 = document.getElementById('test1');
        var table2 = document.getElementById('test2');
        var table3 = document.getElementById('test3');

        // Test 1: caption getter returns first caption element
        if (table1) {
            assert(table1.caption !== null && table1.caption !== undefined,
                "table.caption getter returns a value (not null/undefined)");
        }

        // Test 2: caption is a CAPTION element
        if (table1 && table1.caption) {
            assert(table1.caption.tagName === "CAPTION",
                "table.caption.tagName is 'CAPTION' (was: '" + table1.caption.tagName + "')");
        }

        // Test 3: caption textContent matches
        if (table1 && table1.caption) {
            assert(table1.caption.textContent === "Employee Directory",
                "table.caption.textContent is correct (was: '" + table1.caption.textContent + "')");
        }

        // Test 4: table without caption returns null
        if (table2) {
            assert(table2.caption === null,
                "table.caption returns null when no caption exists (was: " + table2.caption + ")");
        }

        // Test 5: caption setter - replace with new caption
        if (table1) {
            var oldText = table1.caption ? table1.caption.textContent : "";
            var newCap = document.createElement('caption');
            newCap.textContent = "Updated Caption";
            table1.caption = newCap;
            assert(table1.caption !== null && table1.caption.textContent === "Updated Caption",
                "table.caption setter replaces caption (was: '" +
                (table1.caption ? table1.caption.textContent : "null") + "')");
        }

        // Test 6: caption setter - set to null removes caption
        if (table2) {
            var addCap = document.createElement('caption');
            addCap.textContent = "Temporary";
            table2.caption = addCap;
            var hadCaption = table2.caption !== null;
            table2.caption = null;
            assert(table2.caption === null,
                "table.caption = null removes the caption (had caption: " + hadCaption + ")");
        }

        // Test 7: with multiple captions, getter returns first
        if (table3) {
            assert(table3.caption !== null &&
                table3.caption.textContent === "First Caption",
                "table.caption returns FIRST caption child (was: '" +
                (table3.caption ? table3.caption.textContent : "null") + "')");
        }

        info("Tests cover: getter (with/without caption), setter (replace/remove), multiple captions");

        // ========================================
        // table.createCaption() / table.deleteCaption() tests
        // ========================================
        info("--- table.createCaption() / table.deleteCaption() tests ---");

        // Test: createCaption returns existing caption when one exists
        if (table3) {
            var existingCaption = table3.caption;
            var created = table3.createCaption();
            assert(created === existingCaption,
                "createCaption() returns existing caption (same object, not a new one)");
        }

        // Test: createCaption creates a new caption when none exists
        if (table2) {
            // table2 had its caption removed by earlier setter test
            assert(table2.caption === null,
                "table2 has no caption before createCaption() (was: " + table2.caption + ")");
            var newCap = table2.createCaption();
            assert(newCap !== null && newCap !== undefined,
                "createCaption() returns a non-null element");
            assert(newCap.tagName === "CAPTION",
                "createCaption() returns a CAPTION element (was: '" + newCap.tagName + "')");
            assert(table2.caption !== null,
                "table.caption getter now returns the created caption");
        }

        // Test: created caption is inserted as first child
        if (table2 && table2.caption) {
            var firstChild = table2.children[0];
            assert(firstChild.tagName === "CAPTION",
                "createCaption() inserts caption as first child (first child is: '" + firstChild.tagName + "')");
        }

        // Test: deleteCaption removes the caption
        if (table2) {
            table2.deleteCaption();
            assert(table2.caption === null,
                "deleteCaption() removes the caption (table.caption is now: " + table2.caption + ")");
        }

        // Test: deleteCaption on table without caption does nothing (no error)
        if (table5) {
            table5.deleteCaption();
            assert(table5.caption === null,
                "deleteCaption() on table without caption does not throw (caption: " + table5.caption + ")");
        }

        // Test: createCaption then set text, verify content
        if (table2) {
            var cap = table2.createCaption();
            cap.textContent = "Dynamically Created";
            assert(table2.caption.textContent === "Dynamically Created",
                "createCaption() element is writable (text: '" + table2.caption.textContent + "')");
            table2.deleteCaption();
        }

        info("Tests cover: createCaption (existing/new), insertion position, deleteCaption (with/without caption)");

        // ========================================
        // table.tHead tests
        // ========================================
        info("--- table.tHead tests ---");

        var table4 = document.getElementById('test4');
        var table5 = document.getElementById('test5');
        var table6 = document.getElementById('test6');

        // Test 8: tHead getter returns thead element
        if (table4) {
            assert(table4.tHead !== null && table4.tHead !== undefined,
                "table.tHead getter returns a value (not null/undefined)");
        }

        // Test 9: tHead is a THEAD element
        if (table4 && table4.tHead) {
            assert(table4.tHead.tagName === "THEAD",
                "table.tHead.tagName is 'THEAD' (was: '" + table4.tHead.tagName + "')");
        }

        // Test 10: tHead contains expected header text
        if (table4 && table4.tHead) {
            var headerText = table4.tHead.textContent;
            assert(headerText.indexOf("Quarter") !== -1,
                "table.tHead contains header text 'Quarter' (content: '" + headerText.trim() + "')");
        }

        // Test 11: table without thead returns null
        if (table5) {
            assert(table5.tHead === null,
                "table.tHead returns null when no thead exists (was: " + table5.tHead + ")");
        }

        // Test 12: tHead setter - replace with new thead
        if (table4) {
            var newTHead = document.createElement('thead');
            var tr = document.createElement('tr');
            var th = document.createElement('th');
            th.textContent = "New Header";
            tr.appendChild(th);
            newTHead.appendChild(tr);
            table4.tHead = newTHead;
            assert(table4.tHead !== null && table4.tHead.textContent.indexOf("New Header") !== -1,
                "table.tHead setter replaces thead (content: '" +
                (table4.tHead ? table4.tHead.textContent.trim() : "null") + "')");
        }

        // Test 13: tHead setter - set to null removes thead
        if (table5) {
            var addTHead = document.createElement('thead');
            var addTr = document.createElement('tr');
            var addTh = document.createElement('th');
            addTh.textContent = "Temporary Header";
            addTr.appendChild(addTh);
            addTHead.appendChild(addTr);
            table5.tHead = addTHead;
            var hadTHead = table5.tHead !== null;
            table5.tHead = null;
            assert(table5.tHead === null,
                "table.tHead = null removes the thead (had thead: " + hadTHead + ")");
        }

        // Test 14: tHead inserts after caption and colgroup
        if (table6) {
            var newTH = document.createElement('thead');
            var newTr = document.createElement('tr');
            var newTh = document.createElement('th');
            newTh.textContent = "Replaced Header";
            newTr.appendChild(newTh);
            newTH.appendChild(newTr);
            table6.tHead = newTH;

            // Verify caption is still first, and thead comes after caption/colgroup
            var children = table6.children;
            var captionIdx = -1;
            var theadIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "CAPTION" && captionIdx === -1) captionIdx = i;
                if (children[i].tagName === "THEAD" && theadIdx === -1) theadIdx = i;
            }
            assert(captionIdx < theadIdx,
                "tHead inserted after caption (caption at " + captionIdx + ", thead at " + theadIdx + ")");
        }

        info("Tests cover: tHead getter (with/without), setter (replace/remove), insertion order after caption/colgroup");

        // ========================================
        // table.createTHead() / table.deleteTHead() tests
        // ========================================
        info("--- table.createTHead() / table.deleteTHead() tests ---");

        // createTHead returns existing thead when one exists
        if (table4 && table4.tHead) {
            var existingTHead = table4.tHead;
            var created = table4.createTHead();
            assert(created === existingTHead,
                "createTHead() returns existing thead (same object, not a new one)");
        }

        // createTHead creates a new thead when none exists
        if (table5) {
            // table5 had its thead removed by earlier setter test
            assert(table5.tHead === null,
                "table5 has no thead before createTHead() (was: " + table5.tHead + ")");
            var newTH = table5.createTHead();
            assert(newTH !== null && newTH !== undefined,
                "createTHead() returns a non-null element");
            assert(newTH.tagName === "THEAD",
                "createTHead() returns a THEAD element (was: '" + newTH.tagName + "')");
            assert(table5.tHead !== null,
                "table.tHead getter now returns the created thead");
        }

        // createTHead inserts after caption and colgroup
        if (table6) {
            // table6 has caption + colgroup
            table6.deleteTHead();
            var createdTH = table6.createTHead();
            var children = table6.children;
            var captionIdx = -1;
            var theadIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "CAPTION" && captionIdx === -1) captionIdx = i;
                if (children[i].tagName === "THEAD" && theadIdx === -1) theadIdx = i;
            }
            assert(captionIdx < theadIdx,
                "createTHead() inserts after caption (caption at " + captionIdx + ", thead at " + theadIdx + ")");
        }

        // deleteTHead removes the thead
        if (table5) {
            table5.deleteTHead();
            assert(table5.tHead === null,
                "deleteTHead() removes the thead (table.tHead is now: " + table5.tHead + ")");
        }

        // deleteTHead on table without thead does nothing (no error)
        if (table8) {
            table8.deleteTHead();
            assert(table8.tHead === null,
                "deleteTHead() on table without thead does not throw (tHead: " + table8.tHead + ")");
        }

        info("Tests cover: createTHead (existing/new), insertion order after caption/colgroup, deleteTHead (with/without)");

        // ========================================
        // table.tFoot tests
        // ========================================
        info("--- table.tFoot tests ---");

        var table7 = document.getElementById('test7');
        var table8 = document.getElementById('test8');

        // tFoot getter returns tfoot element
        if (table7) {
            assert(table7.tFoot !== null && table7.tFoot !== undefined,
                "table.tFoot getter returns a value (not null/undefined)");
        }

        // tFoot is a TFOOT element
        if (table7 && table7.tFoot) {
            assert(table7.tFoot.tagName === "TFOOT",
                "table.tFoot.tagName is 'TFOOT' (was: '" + table7.tFoot.tagName + "')");
        }

        // tFoot contains expected text
        if (table7 && table7.tFoot) {
            var footText = table7.tFoot.textContent;
            assert(footText.indexOf("Total") !== -1,
                "table.tFoot contains text 'Total' (content: '" + footText.trim() + "')");
        }

        // table without tfoot returns null
        if (table8) {
            assert(table8.tFoot === null,
                "table.tFoot returns null when no tfoot exists (was: " + table8.tFoot + ")");
        }

        // tFoot setter - replace with new tfoot
        if (table7) {
            var newTFoot = document.createElement('tfoot');
            var tr = document.createElement('tr');
            var td = document.createElement('td');
            td.textContent = "New Footer";
            tr.appendChild(td);
            newTFoot.appendChild(tr);
            table7.tFoot = newTFoot;
            assert(table7.tFoot !== null && table7.tFoot.textContent.indexOf("New Footer") !== -1,
                "table.tFoot setter replaces tfoot (content: '" +
                (table7.tFoot ? table7.tFoot.textContent.trim() : "null") + "')");
        }

        // tFoot setter - set to null removes tfoot
        if (table8) {
            var addTFoot = document.createElement('tfoot');
            var addTr = document.createElement('tr');
            var addTd = document.createElement('td');
            addTd.textContent = "Temporary Footer";
            addTr.appendChild(addTd);
            addTFoot.appendChild(addTr);
            table8.tFoot = addTFoot;
            var hadTFoot = table8.tFoot !== null;
            table8.tFoot = null;
            assert(table8.tFoot === null,
                "table.tFoot = null removes the tfoot (had tfoot: " + hadTFoot + ")");
        }

        // tFoot is appended at the end of the table
        if (table7) {
            var newFoot = document.createElement('tfoot');
            var footTr = document.createElement('tr');
            var footTd = document.createElement('td');
            footTd.textContent = "End Footer";
            footTr.appendChild(footTd);
            newFoot.appendChild(footTr);
            table7.tFoot = newFoot;

            var children = table7.children;
            var lastIdx = children.length - 1;
            assert(children[lastIdx].tagName === "TFOOT",
                "tFoot is appended as last child (last child is: '" + children[lastIdx].tagName + "')");
        }

        info("Tests cover: tFoot getter (with/without), setter (replace/remove), appended at end");
    </script>

    <hr>
    <p><a href="index.html">Back to Index</a></p>
</body>
</html>
