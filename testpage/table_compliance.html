<!DOCTYPE html>
<html lang="en">
<head>
    <title>Table Element Compliance Test (WHATWG 4.9.1)</title>
    <meta charset="UTF-8">
    <style>
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .info { color: blue; }
        .test-box { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
    </style>
</head>
<body>
    <h1>Table Element Compliance Test (WHATWG 4.9.1)</h1>

    <div id="results"></div>

    <h2>Visual Tests</h2>

    <h3>Test 1: Table with Caption</h3>
    <div class="test-box">
        <table id="test1">
            <caption>Employee Directory</caption>
            <tr>
                <th>Name</th>
                <th>Role</th>
            </tr>
            <tr>
                <td>Alice</td>
                <td>Developer</td>
            </tr>
        </table>
    </div>
    <p>Expected: "Employee Directory" caption centered above the table</p>

    <h3>Test 2: Table without Caption</h3>
    <div class="test-box">
        <table id="test2">
            <tr>
                <td>No caption here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no caption</p>

    <h3>Test 3: Table with Multiple Captions (only first valid)</h3>
    <div class="test-box">
        <table id="test3">
            <caption>First Caption</caption>
            <caption>Second Caption</caption>
            <tr>
                <td>Data</td>
            </tr>
        </table>
    </div>
    <p>Expected: Per spec, table.caption returns first caption child only</p>

    <h3>Test 4: Table with thead</h3>
    <div class="test-box">
        <table id="test4">
            <caption>Sales Report</caption>
            <thead>
                <tr>
                    <th>Quarter</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Q1</td>
                    <td>$10,000</td>
                </tr>
                <tr>
                    <td>Q2</td>
                    <td>$15,000</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: Table with caption "Sales Report" and a thead containing column headers</p>

    <h3>Test 5: Table without thead</h3>
    <div class="test-box">
        <table id="test5">
            <tr>
                <td>No thead here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no thead element</p>

    <h3>Test 6: Table with caption + colgroup + thead (insertion order test)</h3>
    <div class="test-box">
        <table id="test6">
            <caption>Inventory</caption>
            <colgroup>
                <col style="background-color: #f0f0f0">
                <col>
            </colgroup>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>42</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: Table with caption, colgroup, and thead in correct order</p>

    <h3>Test 7: Table with tfoot</h3>
    <div class="test-box">
        <table id="test7">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>$5.00</td>
                </tr>
                <tr>
                    <td>Gadget</td>
                    <td>$8.00</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td>Total</td>
                    <td>$13.00</td>
                </tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: Table with thead, tbody, and tfoot containing "Total $13.00"</p>

    <h3>Test 8: Table without tfoot</h3>
    <div class="test-box">
        <table id="test8">
            <tr>
                <td>No tfoot here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no tfoot element</p>

    <hr>

    <h2>JavaScript Tests - table.caption</h2>

    <script>
        var results = document.getElementById('results');

        function assert(condition, message) {
            var p = document.createElement('p');
            if (condition) {
                p.innerHTML = "PASS: " + message;
                p.classList.add('pass');
            } else {
                p.innerHTML = "FAIL: " + message;
                p.classList.add('fail');
            }
            results.appendChild(p);
        }

        function info(message) {
            var p = document.createElement('p');
            p.innerHTML = "INFO: " + message;
            p.classList.add('info');
            results.appendChild(p);
        }

        var table1 = document.getElementById('test1');
        var table2 = document.getElementById('test2');
        var table3 = document.getElementById('test3');

        // Test 1: caption getter returns first caption element
        if (table1) {
            assert(table1.caption !== null && table1.caption !== undefined,
                "table.caption getter returns a value (not null/undefined)");
        }

        // Test 2: caption is a CAPTION element
        if (table1 && table1.caption) {
            assert(table1.caption.tagName === "CAPTION",
                "table.caption.tagName is 'CAPTION' (was: '" + table1.caption.tagName + "')");
        }

        // Test 3: caption textContent matches
        if (table1 && table1.caption) {
            assert(table1.caption.textContent === "Employee Directory",
                "table.caption.textContent is correct (was: '" + table1.caption.textContent + "')");
        }

        // Test 4: table without caption returns null
        if (table2) {
            assert(table2.caption === null,
                "table.caption returns null when no caption exists (was: " + table2.caption + ")");
        }

        // Test 5: caption setter - replace with new caption
        if (table1) {
            var oldText = table1.caption ? table1.caption.textContent : "";
            var newCap = document.createElement('caption');
            newCap.textContent = "Updated Caption";
            table1.caption = newCap;
            assert(table1.caption !== null && table1.caption.textContent === "Updated Caption",
                "table.caption setter replaces caption (was: '" +
                (table1.caption ? table1.caption.textContent : "null") + "')");
        }

        // Test 6: caption setter - set to null removes caption
        if (table2) {
            var addCap = document.createElement('caption');
            addCap.textContent = "Temporary";
            table2.caption = addCap;
            var hadCaption = table2.caption !== null;
            table2.caption = null;
            assert(table2.caption === null,
                "table.caption = null removes the caption (had caption: " + hadCaption + ")");
        }

        // Test 7: with multiple captions, getter returns first
        if (table3) {
            assert(table3.caption !== null &&
                table3.caption.textContent === "First Caption",
                "table.caption returns FIRST caption child (was: '" +
                (table3.caption ? table3.caption.textContent : "null") + "')");
        }

        info("Tests cover: getter (with/without caption), setter (replace/remove), multiple captions");

        // ========================================
        // table.createCaption() / table.deleteCaption() tests
        // ========================================
        info("--- table.createCaption() / table.deleteCaption() tests ---");

        // Test: createCaption returns existing caption when one exists
        if (table3) {
            var existingCaption = table3.caption;
            var created = table3.createCaption();
            assert(created === existingCaption,
                "createCaption() returns existing caption (same object, not a new one)");
        }

        // Test: createCaption creates a new caption when none exists
        if (table2) {
            // table2 had its caption removed by earlier setter test
            assert(table2.caption === null,
                "table2 has no caption before createCaption() (was: " + table2.caption + ")");
            var newCap = table2.createCaption();
            assert(newCap !== null && newCap !== undefined,
                "createCaption() returns a non-null element");
            assert(newCap.tagName === "CAPTION",
                "createCaption() returns a CAPTION element (was: '" + newCap.tagName + "')");
            assert(table2.caption !== null,
                "table.caption getter now returns the created caption");
        }

        // Test: created caption is inserted as first child
        if (table2 && table2.caption) {
            var firstChild = table2.children[0];
            assert(firstChild.tagName === "CAPTION",
                "createCaption() inserts caption as first child (first child is: '" + firstChild.tagName + "')");
        }

        // Test: deleteCaption removes the caption
        if (table2) {
            table2.deleteCaption();
            assert(table2.caption === null,
                "deleteCaption() removes the caption (table.caption is now: " + table2.caption + ")");
        }

        // Test: deleteCaption on table without caption does nothing (no error)
        if (table5) {
            table5.deleteCaption();
            assert(table5.caption === null,
                "deleteCaption() on table without caption does not throw (caption: " + table5.caption + ")");
        }

        // Test: createCaption then set text, verify content
        if (table2) {
            var cap = table2.createCaption();
            cap.textContent = "Dynamically Created";
            assert(table2.caption.textContent === "Dynamically Created",
                "createCaption() element is writable (text: '" + table2.caption.textContent + "')");
            table2.deleteCaption();
        }

        info("Tests cover: createCaption (existing/new), insertion position, deleteCaption (with/without caption)");

        // ========================================
        // table.tHead tests
        // ========================================
        info("--- table.tHead tests ---");

        var table4 = document.getElementById('test4');
        var table5 = document.getElementById('test5');
        var table6 = document.getElementById('test6');

        // Test 8: tHead getter returns thead element
        if (table4) {
            assert(table4.tHead !== null && table4.tHead !== undefined,
                "table.tHead getter returns a value (not null/undefined)");
        }

        // Test 9: tHead is a THEAD element
        if (table4 && table4.tHead) {
            assert(table4.tHead.tagName === "THEAD",
                "table.tHead.tagName is 'THEAD' (was: '" + table4.tHead.tagName + "')");
        }

        // Test 10: tHead contains expected header text
        if (table4 && table4.tHead) {
            var headerText = table4.tHead.textContent;
            assert(headerText.indexOf("Quarter") !== -1,
                "table.tHead contains header text 'Quarter' (content: '" + headerText.trim() + "')");
        }

        // Test 11: table without thead returns null
        if (table5) {
            assert(table5.tHead === null,
                "table.tHead returns null when no thead exists (was: " + table5.tHead + ")");
        }

        // Test 12: tHead setter - replace with new thead
        if (table4) {
            var newTHead = document.createElement('thead');
            var tr = document.createElement('tr');
            var th = document.createElement('th');
            th.textContent = "New Header";
            tr.appendChild(th);
            newTHead.appendChild(tr);
            table4.tHead = newTHead;
            assert(table4.tHead !== null && table4.tHead.textContent.indexOf("New Header") !== -1,
                "table.tHead setter replaces thead (content: '" +
                (table4.tHead ? table4.tHead.textContent.trim() : "null") + "')");
        }

        // Test 13: tHead setter - set to null removes thead
        if (table5) {
            var addTHead = document.createElement('thead');
            var addTr = document.createElement('tr');
            var addTh = document.createElement('th');
            addTh.textContent = "Temporary Header";
            addTr.appendChild(addTh);
            addTHead.appendChild(addTr);
            table5.tHead = addTHead;
            var hadTHead = table5.tHead !== null;
            table5.tHead = null;
            assert(table5.tHead === null,
                "table.tHead = null removes the thead (had thead: " + hadTHead + ")");
        }

        // Test 14: tHead inserts after caption and colgroup
        if (table6) {
            var newTH = document.createElement('thead');
            var newTr = document.createElement('tr');
            var newTh = document.createElement('th');
            newTh.textContent = "Replaced Header";
            newTr.appendChild(newTh);
            newTH.appendChild(newTr);
            table6.tHead = newTH;

            // Verify caption is still first, and thead comes after caption/colgroup
            var children = table6.children;
            var captionIdx = -1;
            var theadIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "CAPTION" && captionIdx === -1) captionIdx = i;
                if (children[i].tagName === "THEAD" && theadIdx === -1) theadIdx = i;
            }
            assert(captionIdx < theadIdx,
                "tHead inserted after caption (caption at " + captionIdx + ", thead at " + theadIdx + ")");
        }

        info("Tests cover: tHead getter (with/without), setter (replace/remove), insertion order after caption/colgroup");

        // ========================================
        // table.createTHead() / table.deleteTHead() tests
        // ========================================
        info("--- table.createTHead() / table.deleteTHead() tests ---");

        // createTHead returns existing thead when one exists
        if (table4 && table4.tHead) {
            var existingTHead = table4.tHead;
            var created = table4.createTHead();
            assert(created === existingTHead,
                "createTHead() returns existing thead (same object, not a new one)");
        }

        // createTHead creates a new thead when none exists
        if (table5) {
            // table5 had its thead removed by earlier setter test
            assert(table5.tHead === null,
                "table5 has no thead before createTHead() (was: " + table5.tHead + ")");
            var newTH = table5.createTHead();
            assert(newTH !== null && newTH !== undefined,
                "createTHead() returns a non-null element");
            assert(newTH.tagName === "THEAD",
                "createTHead() returns a THEAD element (was: '" + newTH.tagName + "')");
            assert(table5.tHead !== null,
                "table.tHead getter now returns the created thead");
        }

        // createTHead inserts after caption and colgroup
        if (table6) {
            // table6 has caption + colgroup
            table6.deleteTHead();
            var createdTH = table6.createTHead();
            var children = table6.children;
            var captionIdx = -1;
            var theadIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "CAPTION" && captionIdx === -1) captionIdx = i;
                if (children[i].tagName === "THEAD" && theadIdx === -1) theadIdx = i;
            }
            assert(captionIdx < theadIdx,
                "createTHead() inserts after caption (caption at " + captionIdx + ", thead at " + theadIdx + ")");
        }

        // deleteTHead removes the thead
        if (table5) {
            table5.deleteTHead();
            assert(table5.tHead === null,
                "deleteTHead() removes the thead (table.tHead is now: " + table5.tHead + ")");
        }

        // deleteTHead on table without thead does nothing (no error)
        if (table8) {
            table8.deleteTHead();
            assert(table8.tHead === null,
                "deleteTHead() on table without thead does not throw (tHead: " + table8.tHead + ")");
        }

        info("Tests cover: createTHead (existing/new), insertion order after caption/colgroup, deleteTHead (with/without)");

        // ========================================
        // table.tFoot tests
        // ========================================
        info("--- table.tFoot tests ---");

        var table7 = document.getElementById('test7');
        var table8 = document.getElementById('test8');

        // tFoot getter returns tfoot element
        if (table7) {
            assert(table7.tFoot !== null && table7.tFoot !== undefined,
                "table.tFoot getter returns a value (not null/undefined)");
        }

        // tFoot is a TFOOT element
        if (table7 && table7.tFoot) {
            assert(table7.tFoot.tagName === "TFOOT",
                "table.tFoot.tagName is 'TFOOT' (was: '" + table7.tFoot.tagName + "')");
        }

        // tFoot contains expected text
        if (table7 && table7.tFoot) {
            var footText = table7.tFoot.textContent;
            assert(footText.indexOf("Total") !== -1,
                "table.tFoot contains text 'Total' (content: '" + footText.trim() + "')");
        }

        // table without tfoot returns null
        if (table8) {
            assert(table8.tFoot === null,
                "table.tFoot returns null when no tfoot exists (was: " + table8.tFoot + ")");
        }

        // tFoot setter - replace with new tfoot
        if (table7) {
            var newTFoot = document.createElement('tfoot');
            var tr = document.createElement('tr');
            var td = document.createElement('td');
            td.textContent = "New Footer";
            tr.appendChild(td);
            newTFoot.appendChild(tr);
            table7.tFoot = newTFoot;
            assert(table7.tFoot !== null && table7.tFoot.textContent.indexOf("New Footer") !== -1,
                "table.tFoot setter replaces tfoot (content: '" +
                (table7.tFoot ? table7.tFoot.textContent.trim() : "null") + "')");
        }

        // tFoot setter - set to null removes tfoot
        if (table8) {
            var addTFoot = document.createElement('tfoot');
            var addTr = document.createElement('tr');
            var addTd = document.createElement('td');
            addTd.textContent = "Temporary Footer";
            addTr.appendChild(addTd);
            addTFoot.appendChild(addTr);
            table8.tFoot = addTFoot;
            var hadTFoot = table8.tFoot !== null;
            table8.tFoot = null;
            assert(table8.tFoot === null,
                "table.tFoot = null removes the tfoot (had tfoot: " + hadTFoot + ")");
        }

        // tFoot is appended at the end of the table
        if (table7) {
            var newFoot = document.createElement('tfoot');
            var footTr = document.createElement('tr');
            var footTd = document.createElement('td');
            footTd.textContent = "End Footer";
            footTr.appendChild(footTd);
            newFoot.appendChild(footTr);
            table7.tFoot = newFoot;

            var children = table7.children;
            var lastIdx = children.length - 1;
            assert(children[lastIdx].tagName === "TFOOT",
                "tFoot is appended as last child (last child is: '" + children[lastIdx].tagName + "')");
        }

        info("Tests cover: tFoot getter (with/without), setter (replace/remove), appended at end");

        // ========================================
        // table.createTFoot() / table.deleteTFoot() tests
        // ========================================
        info("--- table.createTFoot() / table.deleteTFoot() tests ---");

        // createTFoot returns existing tfoot when one exists
        if (table7 && table7.tFoot) {
            var existingTFoot = table7.tFoot;
            var created = table7.createTFoot();
            assert(created === existingTFoot,
                "createTFoot() returns existing tfoot (same object, not a new one)");
        }

        // createTFoot creates a new tfoot when none exists
        if (table8) {
            // table8 had its tfoot removed by earlier setter test
            assert(table8.tFoot === null,
                "table8 has no tfoot before createTFoot() (was: " + table8.tFoot + ")");
            var newFoot = table8.createTFoot();
            assert(newFoot !== null && newFoot !== undefined,
                "createTFoot() returns a non-null element");
            assert(newFoot.tagName === "TFOOT",
                "createTFoot() returns a TFOOT element (was: '" + newFoot.tagName + "')");
            assert(table8.tFoot !== null,
                "table.tFoot getter now returns the created tfoot");
        }

        // createTFoot appends at end of table
        if (table8 && table8.tFoot) {
            var children = table8.children;
            var lastIdx = children.length - 1;
            assert(children[lastIdx].tagName === "TFOOT",
                "createTFoot() appends tfoot as last child (last child is: '" + children[lastIdx].tagName + "')");
        }

        // deleteTFoot removes the tfoot
        if (table8) {
            table8.deleteTFoot();
            assert(table8.tFoot === null,
                "deleteTFoot() removes the tfoot (table.tFoot is now: " + table8.tFoot + ")");
        }

        // deleteTFoot on table without tfoot does nothing (no error)
        if (table5) {
            table5.deleteTFoot();
            assert(table5.tFoot === null,
                "deleteTFoot() on table without tfoot does not throw (tFoot: " + table5.tFoot + ")");
        }

        // createTFoot then set text, verify content
        if (table8) {
            var foot = table8.createTFoot();
            foot.textContent = "Dynamic Footer";
            assert(table8.tFoot.textContent === "Dynamic Footer",
                "createTFoot() element is writable (text: '" + table8.tFoot.textContent + "')");
            table8.deleteTFoot();
        }

        info("Tests cover: createTFoot (existing/new), appended at end, deleteTFoot (with/without)");
    </script>

    <!-- ============================================ -->
    <!-- table.tBodies tests                          -->
    <!-- ============================================ -->
    <h2>table.tBodies</h2>

    <!-- Table with multiple tbody elements -->
    <table id="tBodies-1">
        <thead><tr><td>Head</td></tr></thead>
        <tbody id="tb1"><tr><td>Body 1</td></tr></tbody>
        <tbody id="tb2"><tr><td>Body 2</td></tr></tbody>
        <tfoot><tr><td>Foot</td></tr></tfoot>
    </table>

    <!-- Table with no tbody -->
    <table id="tBodies-2">
        <tr><td>No explicit tbody</td></tr>
    </table>

    <!-- Table with single tbody -->
    <table id="tBodies-3">
        <tbody id="tb3"><tr><td>Only body</td></tr></tbody>
    </table>

    <!-- Empty table -->
    <table id="tBodies-4"></table>

    <script>
        info("--- table.tBodies tests ---");

        var tbTable1 = document.getElementById("tBodies-1");
        var tbTable2 = document.getElementById("tBodies-2");
        var tbTable3 = document.getElementById("tBodies-3");
        var tbTable4 = document.getElementById("tBodies-4");

        // tBodies returns collection of tbody elements
        if (tbTable1) {
            assert(tbTable1.tBodies !== null && tbTable1.tBodies !== undefined,
                "tBodies is not null/undefined");
            assert(tbTable1.tBodies.length === 2,
                "table with 2 tbody elements has tBodies.length === 2 (got: " + tbTable1.tBodies.length + ")");
        }

        // tBodies elements have correct tagName
        if (tbTable1 && tbTable1.tBodies.length === 2) {
            assert(tbTable1.tBodies[0].tagName === "TBODY",
                "tBodies[0].tagName === 'TBODY' (got: '" + tbTable1.tBodies[0].tagName + "')");
            assert(tbTable1.tBodies[1].tagName === "TBODY",
                "tBodies[1].tagName === 'TBODY' (got: '" + tbTable1.tBodies[1].tagName + "')");
        }

        // tBodies elements are in document order
        if (tbTable1 && tbTable1.tBodies.length === 2) {
            assert(tbTable1.tBodies[0].id === "tb1",
                "tBodies[0] is first tbody (id: '" + tbTable1.tBodies[0].id + "')");
            assert(tbTable1.tBodies[1].id === "tb2",
                "tBodies[1] is second tbody (id: '" + tbTable1.tBodies[1].id + "')");
        }

        // tBodies on table with no explicit tbody - parser inserts implicit tbody around <tr>
        if (tbTable2) {
            assert(tbTable2.tBodies.length === 1,
                "table with implicit tbody has tBodies.length === 1 (got: " + tbTable2.tBodies.length + ")");
        }

        // tBodies on table with single tbody
        if (tbTable3) {
            assert(tbTable3.tBodies.length === 1,
                "table with 1 tbody has tBodies.length === 1 (got: " + tbTable3.tBodies.length + ")");
            assert(tbTable3.tBodies[0].id === "tb3",
                "single tbody has correct id (got: '" + tbTable3.tBodies[0].id + "')");
        }

        // tBodies on empty table
        if (tbTable4) {
            assert(tbTable4.tBodies.length === 0,
                "empty table has tBodies.length === 0 (got: " + tbTable4.tBodies.length + ")");
        }

        // tBodies does not include thead or tfoot
        if (tbTable1) {
            var allTbodies = tbTable1.tBodies;
            var foundNonTbody = false;
            for (var i = 0; i < allTbodies.length; i++) {
                if (allTbodies[i].tagName !== "TBODY") {
                    foundNonTbody = true;
                }
            }
            assert(!foundNonTbody,
                "tBodies only contains tbody elements, not thead/tfoot");
        }

        info("Tests cover: tBodies (multiple, single, none, empty, ordering, excludes thead/tfoot)");
    </script>

    <!-- ============================================ -->
    <!-- table.createTBody() tests                    -->
    <!-- ============================================ -->
    <h2>table.createTBody()</h2>

    <!-- Table with existing tbody -->
    <table id="ctb-1">
        <thead><tr><td>Head</td></tr></thead>
        <tbody><tr><td>Existing Body</td></tr></tbody>
        <tfoot><tr><td>Foot</td></tr></tfoot>
    </table>

    <!-- Empty table -->
    <table id="ctb-2"></table>

    <!-- Table with multiple tbodies -->
    <table id="ctb-3">
        <tbody id="ctb3-first"><tr><td>First</td></tr></tbody>
        <tbody id="ctb3-second"><tr><td>Second</td></tr></tbody>
    </table>

    <script>
        info("--- table.createTBody() tests ---");

        var ctbTable1 = document.getElementById("ctb-1");
        var ctbTable2 = document.getElementById("ctb-2");
        var ctbTable3 = document.getElementById("ctb-3");

        // createTBody always creates a new element (never returns existing)
        if (ctbTable1) {
            var beforeCount = ctbTable1.tBodies.length;
            var newBody = ctbTable1.createTBody();
            assert(newBody !== null && newBody !== undefined,
                "createTBody() returns an element");
            assert(newBody.tagName === "TBODY",
                "createTBody() returns a TBODY element (got: '" + newBody.tagName + "')");
            assert(ctbTable1.tBodies.length === beforeCount + 1,
                "createTBody() adds a new tbody (count: " + beforeCount + " -> " + ctbTable1.tBodies.length + ")");
        }

        // createTBody inserts after the last tbody (before tfoot)
        if (ctbTable1) {
            var children = ctbTable1.children;
            var tbodyIndices = [];
            var tfootIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "TBODY") tbodyIndices.push(i);
                if (children[i].tagName === "TFOOT") tfootIdx = i;
            }
            var lastTbodyIdx = tbodyIndices[tbodyIndices.length - 1];
            assert(tfootIdx > lastTbodyIdx,
                "new tbody is inserted before tfoot (lastTbody: " + lastTbodyIdx + ", tfoot: " + tfootIdx + ")");
        }

        // createTBody on empty table
        if (ctbTable2) {
            var newBody2 = ctbTable2.createTBody();
            assert(ctbTable2.tBodies.length === 1,
                "createTBody() on empty table creates first tbody (count: " + ctbTable2.tBodies.length + ")");
        }

        // createTBody with multiple existing tbodies inserts after the last one
        if (ctbTable3) {
            var newBody3 = ctbTable3.createTBody();
            var bodies = ctbTable3.tBodies;
            assert(bodies.length === 3,
                "createTBody() adds third tbody (count: " + bodies.length + ")");
            assert(bodies[0].id === "ctb3-first",
                "first tbody unchanged (id: '" + bodies[0].id + "')");
            assert(bodies[1].id === "ctb3-second",
                "second tbody unchanged (id: '" + bodies[1].id + "')");
            assert(bodies[2] === newBody3,
                "new tbody is last in tBodies collection");
        }

        // Calling createTBody multiple times creates multiple tbodies
        if (ctbTable2) {
            var before = ctbTable2.tBodies.length;
            ctbTable2.createTBody();
            ctbTable2.createTBody();
            assert(ctbTable2.tBodies.length === before + 2,
                "calling createTBody() twice adds 2 tbodies (count: " + ctbTable2.tBodies.length + ")");
        }

        info("Tests cover: createTBody (always new, insertion after last tbody, empty table, multiple calls)");
    </script>

    <!-- ============================================ -->
    <!-- table.rows tests                              -->
    <!-- ============================================ -->
    <h2>table.rows</h2>

    <!-- Table with thead, tbody, tfoot -->
    <table id="rows-1">
        <thead><tr id="r1-h1"><td>Head 1</td></tr></thead>
        <tbody>
            <tr id="r1-b1"><td>Body 1</td></tr>
            <tr id="r1-b2"><td>Body 2</td></tr>
        </tbody>
        <tfoot><tr id="r1-f1"><td>Foot 1</td></tr></tfoot>
    </table>

    <!-- Table with only tbody rows -->
    <table id="rows-2">
        <tbody>
            <tr id="r2-b1"><td>Row 1</td></tr>
            <tr id="r2-b2"><td>Row 2</td></tr>
        </tbody>
    </table>

    <!-- Table with implicit tbody (parser wraps tr in tbody) -->
    <table id="rows-3">
        <tr id="r3-1"><td>Implicit 1</td></tr>
        <tr id="r3-2"><td>Implicit 2</td></tr>
    </table>

    <!-- Empty table -->
    <table id="rows-4"></table>

    <!-- Table with multiple tbodies -->
    <table id="rows-5">
        <thead><tr id="r5-h1"><td>Head</td></tr></thead>
        <tbody>
            <tr id="r5-b1"><td>Body A1</td></tr>
        </tbody>
        <tbody>
            <tr id="r5-b2"><td>Body B1</td></tr>
            <tr id="r5-b3"><td>Body B2</td></tr>
        </tbody>
        <tfoot><tr id="r5-f1"><td>Foot</td></tr></tfoot>
    </table>

    <!-- Table with tfoot before tbody in DOM (tests ordering) -->
    <table id="rows-6">
        <thead><tr id="r6-h1"><td>Head</td></tr></thead>
        <tfoot><tr id="r6-f1"><td>Foot</td></tr></tfoot>
        <tbody><tr id="r6-b1"><td>Body</td></tr></tbody>
    </table>

    <!-- Table with thead only -->
    <table id="rows-7">
        <thead>
            <tr id="r7-h1"><td>Header 1</td></tr>
            <tr id="r7-h2"><td>Header 2</td></tr>
        </thead>
    </table>

    <script>
        info("--- table.rows tests ---");

        var rowsT1 = document.getElementById("rows-1");
        var rowsT2 = document.getElementById("rows-2");
        var rowsT3 = document.getElementById("rows-3");
        var rowsT4 = document.getElementById("rows-4");
        var rowsT5 = document.getElementById("rows-5");
        var rowsT6 = document.getElementById("rows-6");
        var rowsT7 = document.getElementById("rows-7");

        // Basic: rows is not null/undefined
        if (rowsT1) {
            assert(rowsT1.rows !== null && rowsT1.rows !== undefined,
                "table.rows is not null/undefined");
        }

        // Row count: thead(1) + tbody(2) + tfoot(1) = 4
        if (rowsT1) {
            assert(rowsT1.rows.length === 4,
                "table with thead(1)+tbody(2)+tfoot(1) has rows.length === 4 (got: " + rowsT1.rows.length + ")");
        }

        // Ordering: thead rows come first
        if (rowsT1 && rowsT1.rows.length === 4) {
            assert(rowsT1.rows[0].id === "r1-h1",
                "rows[0] is thead row (id: '" + rowsT1.rows[0].id + "')");
        }

        // Ordering: tbody rows come in the middle
        if (rowsT1 && rowsT1.rows.length === 4) {
            assert(rowsT1.rows[1].id === "r1-b1",
                "rows[1] is first tbody row (id: '" + rowsT1.rows[1].id + "')");
            assert(rowsT1.rows[2].id === "r1-b2",
                "rows[2] is second tbody row (id: '" + rowsT1.rows[2].id + "')");
        }

        // Ordering: tfoot rows come last
        if (rowsT1 && rowsT1.rows.length === 4) {
            assert(rowsT1.rows[3].id === "r1-f1",
                "rows[3] is tfoot row (id: '" + rowsT1.rows[3].id + "')");
        }

        // All rows have TR tagName
        if (rowsT1) {
            var allTR = true;
            for (var i = 0; i < rowsT1.rows.length; i++) {
                if (rowsT1.rows[i].tagName !== "TR") allTR = false;
            }
            assert(allTR, "all entries in rows have tagName 'TR'");
        }

        // Table with only tbody rows
        if (rowsT2) {
            assert(rowsT2.rows.length === 2,
                "table with only tbody has rows.length === 2 (got: " + rowsT2.rows.length + ")");
            assert(rowsT2.rows[0].id === "r2-b1",
                "tbody-only rows[0] is correct (id: '" + rowsT2.rows[0].id + "')");
            assert(rowsT2.rows[1].id === "r2-b2",
                "tbody-only rows[1] is correct (id: '" + rowsT2.rows[1].id + "')");
        }

        // Table with implicit tbody (parser inserts tbody around bare tr)
        if (rowsT3) {
            assert(rowsT3.rows.length === 2,
                "table with implicit tbody has rows.length === 2 (got: " + rowsT3.rows.length + ")");
            assert(rowsT3.rows[0].id === "r3-1",
                "implicit tbody rows[0] correct (id: '" + rowsT3.rows[0].id + "')");
        }

        // Empty table
        if (rowsT4) {
            assert(rowsT4.rows.length === 0,
                "empty table has rows.length === 0 (got: " + rowsT4.rows.length + ")");
        }

        // Multiple tbodies: rows collected in tree order across all tbodies
        if (rowsT5) {
            assert(rowsT5.rows.length === 5,
                "table with thead(1)+tbody(1)+tbody(2)+tfoot(1) has rows.length === 5 (got: " + rowsT5.rows.length + ")");
            assert(rowsT5.rows[0].id === "r5-h1",
                "multi-tbody rows[0] is thead row (id: '" + rowsT5.rows[0].id + "')");
            assert(rowsT5.rows[1].id === "r5-b1",
                "multi-tbody rows[1] is first tbody row (id: '" + rowsT5.rows[1].id + "')");
            assert(rowsT5.rows[2].id === "r5-b2",
                "multi-tbody rows[2] is second tbody first row (id: '" + rowsT5.rows[2].id + "')");
            assert(rowsT5.rows[3].id === "r5-b3",
                "multi-tbody rows[3] is second tbody second row (id: '" + rowsT5.rows[3].id + "')");
            assert(rowsT5.rows[4].id === "r5-f1",
                "multi-tbody rows[4] is tfoot row (id: '" + rowsT5.rows[4].id + "')");
        }

        // tfoot before tbody in DOM: rows still ordered thead -> tbody -> tfoot
        if (rowsT6) {
            assert(rowsT6.rows.length === 3,
                "table with reordered sections has rows.length === 3 (got: " + rowsT6.rows.length + ")");
            assert(rowsT6.rows[0].id === "r6-h1",
                "reordered rows[0] is thead row (id: '" + rowsT6.rows[0].id + "')");
            assert(rowsT6.rows[1].id === "r6-b1",
                "reordered rows[1] is tbody row (id: '" + rowsT6.rows[1].id + "')");
            assert(rowsT6.rows[2].id === "r6-f1",
                "reordered rows[2] is tfoot row (id: '" + rowsT6.rows[2].id + "')");
        }

        // Table with only thead
        if (rowsT7) {
            assert(rowsT7.rows.length === 2,
                "thead-only table has rows.length === 2 (got: " + rowsT7.rows.length + ")");
            assert(rowsT7.rows[0].id === "r7-h1",
                "thead-only rows[0] correct (id: '" + rowsT7.rows[0].id + "')");
            assert(rowsT7.rows[1].id === "r7-h2",
                "thead-only rows[1] correct (id: '" + rowsT7.rows[1].id + "')");
        }

        info("Tests cover: rows (count, ordering thead/tbody/tfoot, multiple tbodies, implicit tbody, empty, reordered DOM, thead-only)");
    </script>

    <!-- ============================================ -->
    <!-- table.insertRow() tests                       -->
    <!-- ============================================ -->
    <h2>table.insertRow()</h2>

    <!-- Table with all sections for insertRow -->
    <table id="ir-1">
        <thead><tr id="ir1-h1"><td>Head</td></tr></thead>
        <tbody>
            <tr id="ir1-b1"><td>Body 1</td></tr>
            <tr id="ir1-b2"><td>Body 2</td></tr>
        </tbody>
        <tfoot><tr id="ir1-f1"><td>Foot</td></tr></tfoot>
    </table>

    <!-- Empty table for insertRow -->
    <table id="ir-2"></table>

    <!-- Table with multiple tbodies for insertRow -->
    <table id="ir-3">
        <tbody><tr id="ir3-b1"><td>Body A</td></tr></tbody>
        <tbody><tr id="ir3-b2"><td>Body B</td></tr></tbody>
    </table>

    <script>
        info("--- table.insertRow() tests ---");

        var irT1 = document.getElementById("ir-1");
        var irT2 = document.getElementById("ir-2");
        var irT3 = document.getElementById("ir-3");

        // insertRow(-1) appends to parent of last row in table.rows
        if (irT1) {
            var before = irT1.rows.length;
            var newRow = irT1.insertRow(-1);
            assert(newRow !== null && newRow !== undefined,
                "insertRow(-1) returns an element");
            assert(newRow.tagName === "TR",
                "insertRow(-1) returns a TR element (got: '" + newRow.tagName + "')");
            assert(irT1.rows.length === before + 1,
                "insertRow(-1) increases row count (was: " + before + ", now: " + irT1.rows.length + ")");
        }

        // insertRow(-1) new row is now the last row (appended to tfoot, parent of last row)
        if (irT1) {
            var rows = irT1.rows;
            var lastIdx = rows.length - 1;
            assert(rows[lastIdx] !== null && rows[lastIdx].id === "",
                "after insertRow(-1), new row is last in rows (parent is tfoot of last row)");
            assert(rows[lastIdx - 1].id === "ir1-f1",
                "original tfoot row is second-to-last (id: '" + rows[lastIdx - 1].id + "')");
        }

        // insertRow() with no args same as insertRow(-1)
        if (irT1) {
            var before = irT1.rows.length;
            var newRow = irT1.insertRow();
            assert(irT1.rows.length === before + 1,
                "insertRow() with no args appends row (count: " + before + " -> " + irT1.rows.length + ")");
        }

        // insertRow(0) inserts before first row
        if (irT1) {
            var newRow = irT1.insertRow(0);
            newRow.id = "ir1-inserted-0";
            assert(irT1.rows[0].id === "ir1-inserted-0",
                "insertRow(0) new row is first in rows (got: '" + irT1.rows[0].id + "')");
        }

        // insertRow(N) inserts at specific position
        if (irT1) {
            var before = irT1.rows.length;
            var newRow = irT1.insertRow(2);
            newRow.id = "ir1-inserted-2";
            assert(irT1.rows[2].id === "ir1-inserted-2",
                "insertRow(2) new row is at index 2 (got: '" + irT1.rows[2].id + "')");
            assert(irT1.rows.length === before + 1,
                "insertRow(2) increases row count by 1");
        }

        // insertRow on empty table creates tbody and row
        if (irT2) {
            var newRow = irT2.insertRow();
            assert(newRow !== null && newRow !== undefined,
                "insertRow() on empty table returns an element");
            assert(newRow.tagName === "TR",
                "insertRow() on empty table returns TR");
            assert(irT2.rows.length === 1,
                "empty table now has 1 row (got: " + irT2.rows.length + ")");
            assert(irT2.tBodies.length === 1,
                "insertRow() on empty table created a tbody (got: " + irT2.tBodies.length + ")");
        }

        // insertRow(rows.length) same as insertRow(-1)
        if (irT3) {
            var len = irT3.rows.length;
            var newRow = irT3.insertRow(len);
            assert(irT3.rows.length === len + 1,
                "insertRow(rows.length) appends row (was: " + len + ", now: " + irT3.rows.length + ")");
        }

        info("Tests cover: insertRow(-1), insertRow(), insertRow(0), insertRow(N), empty table, insertRow(rows.length)");
    </script>

    <!-- ============================================ -->
    <!-- table.deleteRow() tests                       -->
    <!-- ============================================ -->
    <h2>table.deleteRow()</h2>

    <!-- Table with all sections for deleteRow -->
    <table id="dr-1">
        <thead><tr id="dr1-h1"><td>Head</td></tr></thead>
        <tbody>
            <tr id="dr1-b1"><td>Body 1</td></tr>
            <tr id="dr1-b2"><td>Body 2</td></tr>
            <tr id="dr1-b3"><td>Body 3</td></tr>
        </tbody>
        <tfoot><tr id="dr1-f1"><td>Foot</td></tr></tfoot>
    </table>

    <!-- Table for deleteRow(-1) -->
    <table id="dr-2">
        <tbody>
            <tr id="dr2-b1"><td>Row 1</td></tr>
            <tr id="dr2-b2"><td>Row 2</td></tr>
            <tr id="dr2-b3"><td>Row 3</td></tr>
        </tbody>
    </table>

    <!-- Table with single row for deletion -->
    <table id="dr-3">
        <tbody><tr id="dr3-b1"><td>Only Row</td></tr></tbody>
    </table>

    <script>
        info("--- table.deleteRow() tests ---");

        var drT1 = document.getElementById("dr-1");
        var drT2 = document.getElementById("dr-2");
        var drT3 = document.getElementById("dr-3");

        // deleteRow(index) removes the correct row
        if (drT1) {
            var before = drT1.rows.length;
            drT1.deleteRow(1);
            assert(drT1.rows.length === before - 1,
                "deleteRow(1) decreases row count (was: " + before + ", now: " + drT1.rows.length + ")");
            var found = false;
            for (var i = 0; i < drT1.rows.length; i++) {
                if (drT1.rows[i].id === "dr1-b1") found = true;
            }
            assert(!found,
                "deleteRow(1) removed row 'dr1-b1' from collection");
        }

        // deleteRow(0) removes first row (thead row)
        if (drT1) {
            var before = drT1.rows.length;
            drT1.deleteRow(0);
            assert(drT1.rows.length === before - 1,
                "deleteRow(0) removes first row");
            assert(drT1.rows[0].id === "dr1-b2",
                "after deleteRow(0), new first row is 'dr1-b2' (got: '" + drT1.rows[0].id + "')");
        }

        // deleteRow removes tfoot row by index
        if (drT1) {
            var lastIdx = drT1.rows.length - 1;
            var lastId = drT1.rows[lastIdx].id;
            assert(lastId === "dr1-f1",
                "last row is tfoot row before deletion (got: '" + lastId + "')");
            drT1.deleteRow(lastIdx);
            var found = false;
            for (var i = 0; i < drT1.rows.length; i++) {
                if (drT1.rows[i].id === "dr1-f1") found = true;
            }
            assert(!found,
                "deleteRow(lastIdx) removed tfoot row 'dr1-f1'");
        }

        // deleteRow(-1) removes last row
        if (drT2) {
            var before = drT2.rows.length;
            drT2.deleteRow(-1);
            assert(drT2.rows.length === before - 1,
                "deleteRow(-1) decreases row count (was: " + before + ", now: " + drT2.rows.length + ")");
            var found = false;
            for (var i = 0; i < drT2.rows.length; i++) {
                if (drT2.rows[i].id === "dr2-b3") found = true;
            }
            assert(!found,
                "deleteRow(-1) removed last row 'dr2-b3'");
        }

        // deleteRow(-1) again removes new last row
        if (drT2) {
            drT2.deleteRow(-1);
            assert(drT2.rows.length === 1,
                "second deleteRow(-1) leaves 1 row (got: " + drT2.rows.length + ")");
            assert(drT2.rows[0].id === "dr2-b1",
                "remaining row is 'dr2-b1' (got: '" + drT2.rows[0].id + "')");
        }

        // deleteRow on single-row table empties it
        if (drT3) {
            assert(drT3.rows.length === 1,
                "single-row table starts with 1 row");
            drT3.deleteRow(0);
            assert(drT3.rows.length === 0,
                "deleteRow(0) on single-row table leaves 0 rows (got: " + drT3.rows.length + ")");
        }

        info("Tests cover: deleteRow(index), deleteRow(0), deleteRow(-1), tfoot row deletion, repeated deletion, single-row table");
    </script>

    <hr>
    <p><a href="index.html">Back to Index</a></p>
</body>
</html>
