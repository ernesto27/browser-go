<!DOCTYPE html>
<html lang="en">
<head>
    <title>Table Element Compliance Test (WHATWG 4.9.1)</title>
    <meta charset="UTF-8">
    <style>
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .info { color: blue; }
        .test-box { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
    </style>
</head>
<body>
    <h1>Table Element Compliance Test (WHATWG 4.9.1)</h1>

    <div id="results"></div>

    <h2>Visual Tests</h2>

    <h3>Test 1: Table with Caption</h3>
    <div class="test-box">
        <table id="test1">
            <caption>Employee Directory</caption>
            <tr>
                <th>Name</th>
                <th>Role</th>
            </tr>
            <tr>
                <td>Alice</td>
                <td>Developer</td>
            </tr>
        </table>
    </div>
    <p>Expected: "Employee Directory" caption centered above the table</p>

    <h3>Test 2: Table without Caption</h3>
    <div class="test-box">
        <table id="test2">
            <tr>
                <td>No caption here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no caption</p>

    <h3>Test 3: Table with Multiple Captions (only first valid)</h3>
    <div class="test-box">
        <table id="test3">
            <caption>First Caption</caption>
            <caption>Second Caption</caption>
            <tr>
                <td>Data</td>
            </tr>
        </table>
    </div>
    <p>Expected: Per spec, table.caption returns first caption child only</p>

    <h3>Test 4: Table with thead</h3>
    <div class="test-box">
        <table id="test4">
            <caption>Sales Report</caption>
            <thead>
                <tr>
                    <th>Quarter</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Q1</td>
                    <td>$10,000</td>
                </tr>
                <tr>
                    <td>Q2</td>
                    <td>$15,000</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: Table with caption "Sales Report" and a thead containing column headers</p>

    <h3>Test 5: Table without thead</h3>
    <div class="test-box">
        <table id="test5">
            <tr>
                <td>No thead here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no thead element</p>

    <h3>Test 6: Table with caption + colgroup + thead (insertion order test)</h3>
    <div class="test-box">
        <table id="test6">
            <caption>Inventory</caption>
            <colgroup>
                <col style="background-color: #f0f0f0">
                <col>
            </colgroup>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>42</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: Table with caption, colgroup, and thead in correct order</p>

    <h3>Test 7: Table with tfoot</h3>
    <div class="test-box">
        <table id="test7">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>$5.00</td>
                </tr>
                <tr>
                    <td>Gadget</td>
                    <td>$8.00</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td>Total</td>
                    <td>$13.00</td>
                </tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: Table with thead, tbody, and tfoot containing "Total $13.00"</p>

    <h3>Test 8: Table without tfoot</h3>
    <div class="test-box">
        <table id="test8">
            <tr>
                <td>No tfoot here</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table with no tfoot element</p>

    <hr>

    <h2>JavaScript Tests - table.caption</h2>

    <script>
        var results = document.getElementById('results');

        function assert(condition, message) {
            var p = document.createElement('p');
            if (condition) {
                p.innerHTML = "PASS: " + message;
                p.classList.add('pass');
            } else {
                p.innerHTML = "FAIL: " + message;
                p.classList.add('fail');
            }
            results.appendChild(p);
        }

        function info(message) {
            var p = document.createElement('p');
            p.innerHTML = "INFO: " + message;
            p.classList.add('info');
            results.appendChild(p);
        }

        var table1 = document.getElementById('test1');
        var table2 = document.getElementById('test2');
        var table3 = document.getElementById('test3');

        // Test 1: caption getter returns first caption element
        if (table1) {
            assert(table1.caption !== null && table1.caption !== undefined,
                "table.caption getter returns a value (not null/undefined)");
        }

        // Test 2: caption is a CAPTION element
        if (table1 && table1.caption) {
            assert(table1.caption.tagName === "CAPTION",
                "table.caption.tagName is 'CAPTION' (was: '" + table1.caption.tagName + "')");
        }

        // Test 3: caption textContent matches
        if (table1 && table1.caption) {
            assert(table1.caption.textContent === "Employee Directory",
                "table.caption.textContent is correct (was: '" + table1.caption.textContent + "')");
        }

        // Test 4: table without caption returns null
        if (table2) {
            assert(table2.caption === null,
                "table.caption returns null when no caption exists (was: " + table2.caption + ")");
        }

        // Test 5: caption setter - replace with new caption
        if (table1) {
            var oldText = table1.caption ? table1.caption.textContent : "";
            var newCap = document.createElement('caption');
            newCap.textContent = "Updated Caption";
            table1.caption = newCap;
            assert(table1.caption !== null && table1.caption.textContent === "Updated Caption",
                "table.caption setter replaces caption (was: '" +
                (table1.caption ? table1.caption.textContent : "null") + "')");
        }

        // Test 6: caption setter - set to null removes caption
        if (table2) {
            var addCap = document.createElement('caption');
            addCap.textContent = "Temporary";
            table2.caption = addCap;
            var hadCaption = table2.caption !== null;
            table2.caption = null;
            assert(table2.caption === null,
                "table.caption = null removes the caption (had caption: " + hadCaption + ")");
        }

        // Test 7: with multiple captions, getter returns first
        if (table3) {
            assert(table3.caption !== null &&
                table3.caption.textContent === "First Caption",
                "table.caption returns FIRST caption child (was: '" +
                (table3.caption ? table3.caption.textContent : "null") + "')");
        }

        info("Tests cover: getter (with/without caption), setter (replace/remove), multiple captions");

        // ========================================
        // table.createCaption() / table.deleteCaption() tests
        // ========================================
        info("--- table.createCaption() / table.deleteCaption() tests ---");

        // Test: createCaption returns existing caption when one exists
        if (table3) {
            var existingCaption = table3.caption;
            var created = table3.createCaption();
            assert(created === existingCaption,
                "createCaption() returns existing caption (same object, not a new one)");
        }

        // Test: createCaption creates a new caption when none exists
        if (table2) {
            // table2 had its caption removed by earlier setter test
            assert(table2.caption === null,
                "table2 has no caption before createCaption() (was: " + table2.caption + ")");
            var newCap = table2.createCaption();
            assert(newCap !== null && newCap !== undefined,
                "createCaption() returns a non-null element");
            assert(newCap.tagName === "CAPTION",
                "createCaption() returns a CAPTION element (was: '" + newCap.tagName + "')");
            assert(table2.caption !== null,
                "table.caption getter now returns the created caption");
        }

        // Test: created caption is inserted as first child
        if (table2 && table2.caption) {
            var firstChild = table2.children[0];
            assert(firstChild.tagName === "CAPTION",
                "createCaption() inserts caption as first child (first child is: '" + firstChild.tagName + "')");
        }

        // Test: deleteCaption removes the caption
        if (table2) {
            table2.deleteCaption();
            assert(table2.caption === null,
                "deleteCaption() removes the caption (table.caption is now: " + table2.caption + ")");
        }

        // Test: deleteCaption on table without caption does nothing (no error)
        if (table5) {
            table5.deleteCaption();
            assert(table5.caption === null,
                "deleteCaption() on table without caption does not throw (caption: " + table5.caption + ")");
        }

        // Test: createCaption then set text, verify content
        if (table2) {
            var cap = table2.createCaption();
            cap.textContent = "Dynamically Created";
            assert(table2.caption.textContent === "Dynamically Created",
                "createCaption() element is writable (text: '" + table2.caption.textContent + "')");
            table2.deleteCaption();
        }

        info("Tests cover: createCaption (existing/new), insertion position, deleteCaption (with/without caption)");

        // ========================================
        // table.tHead tests
        // ========================================
        info("--- table.tHead tests ---");

        var table4 = document.getElementById('test4');
        var table5 = document.getElementById('test5');
        var table6 = document.getElementById('test6');

        // Test 8: tHead getter returns thead element
        if (table4) {
            assert(table4.tHead !== null && table4.tHead !== undefined,
                "table.tHead getter returns a value (not null/undefined)");
        }

        // Test 9: tHead is a THEAD element
        if (table4 && table4.tHead) {
            assert(table4.tHead.tagName === "THEAD",
                "table.tHead.tagName is 'THEAD' (was: '" + table4.tHead.tagName + "')");
        }

        // Test 10: tHead contains expected header text
        if (table4 && table4.tHead) {
            var headerText = table4.tHead.textContent;
            assert(headerText.indexOf("Quarter") !== -1,
                "table.tHead contains header text 'Quarter' (content: '" + headerText.trim() + "')");
        }

        // Test 11: table without thead returns null
        if (table5) {
            assert(table5.tHead === null,
                "table.tHead returns null when no thead exists (was: " + table5.tHead + ")");
        }

        // Test 12: tHead setter - replace with new thead
        if (table4) {
            var newTHead = document.createElement('thead');
            var tr = document.createElement('tr');
            var th = document.createElement('th');
            th.textContent = "New Header";
            tr.appendChild(th);
            newTHead.appendChild(tr);
            table4.tHead = newTHead;
            assert(table4.tHead !== null && table4.tHead.textContent.indexOf("New Header") !== -1,
                "table.tHead setter replaces thead (content: '" +
                (table4.tHead ? table4.tHead.textContent.trim() : "null") + "')");
        }

        // Test 13: tHead setter - set to null removes thead
        if (table5) {
            var addTHead = document.createElement('thead');
            var addTr = document.createElement('tr');
            var addTh = document.createElement('th');
            addTh.textContent = "Temporary Header";
            addTr.appendChild(addTh);
            addTHead.appendChild(addTr);
            table5.tHead = addTHead;
            var hadTHead = table5.tHead !== null;
            table5.tHead = null;
            assert(table5.tHead === null,
                "table.tHead = null removes the thead (had thead: " + hadTHead + ")");
        }

        // Test 14: tHead inserts after caption and colgroup
        if (table6) {
            var newTH = document.createElement('thead');
            var newTr = document.createElement('tr');
            var newTh = document.createElement('th');
            newTh.textContent = "Replaced Header";
            newTr.appendChild(newTh);
            newTH.appendChild(newTr);
            table6.tHead = newTH;

            // Verify caption is still first, and thead comes after caption/colgroup
            var children = table6.children;
            var captionIdx = -1;
            var theadIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "CAPTION" && captionIdx === -1) captionIdx = i;
                if (children[i].tagName === "THEAD" && theadIdx === -1) theadIdx = i;
            }
            assert(captionIdx < theadIdx,
                "tHead inserted after caption (caption at " + captionIdx + ", thead at " + theadIdx + ")");
        }

        info("Tests cover: tHead getter (with/without), setter (replace/remove), insertion order after caption/colgroup");

        // ========================================
        // table.createTHead() / table.deleteTHead() tests
        // ========================================
        info("--- table.createTHead() / table.deleteTHead() tests ---");

        // createTHead returns existing thead when one exists
        if (table4 && table4.tHead) {
            var existingTHead = table4.tHead;
            var created = table4.createTHead();
            assert(created === existingTHead,
                "createTHead() returns existing thead (same object, not a new one)");
        }

        // createTHead creates a new thead when none exists
        if (table5) {
            // table5 had its thead removed by earlier setter test
            assert(table5.tHead === null,
                "table5 has no thead before createTHead() (was: " + table5.tHead + ")");
            var newTH = table5.createTHead();
            assert(newTH !== null && newTH !== undefined,
                "createTHead() returns a non-null element");
            assert(newTH.tagName === "THEAD",
                "createTHead() returns a THEAD element (was: '" + newTH.tagName + "')");
            assert(table5.tHead !== null,
                "table.tHead getter now returns the created thead");
        }

        // createTHead inserts after caption and colgroup
        if (table6) {
            // table6 has caption + colgroup
            table6.deleteTHead();
            var createdTH = table6.createTHead();
            var children = table6.children;
            var captionIdx = -1;
            var theadIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "CAPTION" && captionIdx === -1) captionIdx = i;
                if (children[i].tagName === "THEAD" && theadIdx === -1) theadIdx = i;
            }
            assert(captionIdx < theadIdx,
                "createTHead() inserts after caption (caption at " + captionIdx + ", thead at " + theadIdx + ")");
        }

        // deleteTHead removes the thead
        if (table5) {
            table5.deleteTHead();
            assert(table5.tHead === null,
                "deleteTHead() removes the thead (table.tHead is now: " + table5.tHead + ")");
        }

        // deleteTHead on table without thead does nothing (no error)
        if (table8) {
            table8.deleteTHead();
            assert(table8.tHead === null,
                "deleteTHead() on table without thead does not throw (tHead: " + table8.tHead + ")");
        }

        info("Tests cover: createTHead (existing/new), insertion order after caption/colgroup, deleteTHead (with/without)");

        // ========================================
        // table.tFoot tests
        // ========================================
        info("--- table.tFoot tests ---");

        var table7 = document.getElementById('test7');
        var table8 = document.getElementById('test8');

        // tFoot getter returns tfoot element
        if (table7) {
            assert(table7.tFoot !== null && table7.tFoot !== undefined,
                "table.tFoot getter returns a value (not null/undefined)");
        }

        // tFoot is a TFOOT element
        if (table7 && table7.tFoot) {
            assert(table7.tFoot.tagName === "TFOOT",
                "table.tFoot.tagName is 'TFOOT' (was: '" + table7.tFoot.tagName + "')");
        }

        // tFoot contains expected text
        if (table7 && table7.tFoot) {
            var footText = table7.tFoot.textContent;
            assert(footText.indexOf("Total") !== -1,
                "table.tFoot contains text 'Total' (content: '" + footText.trim() + "')");
        }

        // table without tfoot returns null
        if (table8) {
            assert(table8.tFoot === null,
                "table.tFoot returns null when no tfoot exists (was: " + table8.tFoot + ")");
        }

        // tFoot setter - replace with new tfoot
        if (table7) {
            var newTFoot = document.createElement('tfoot');
            var tr = document.createElement('tr');
            var td = document.createElement('td');
            td.textContent = "New Footer";
            tr.appendChild(td);
            newTFoot.appendChild(tr);
            table7.tFoot = newTFoot;
            assert(table7.tFoot !== null && table7.tFoot.textContent.indexOf("New Footer") !== -1,
                "table.tFoot setter replaces tfoot (content: '" +
                (table7.tFoot ? table7.tFoot.textContent.trim() : "null") + "')");
        }

        // tFoot setter - set to null removes tfoot
        if (table8) {
            var addTFoot = document.createElement('tfoot');
            var addTr = document.createElement('tr');
            var addTd = document.createElement('td');
            addTd.textContent = "Temporary Footer";
            addTr.appendChild(addTd);
            addTFoot.appendChild(addTr);
            table8.tFoot = addTFoot;
            var hadTFoot = table8.tFoot !== null;
            table8.tFoot = null;
            assert(table8.tFoot === null,
                "table.tFoot = null removes the tfoot (had tfoot: " + hadTFoot + ")");
        }

        // tFoot is appended at the end of the table
        if (table7) {
            var newFoot = document.createElement('tfoot');
            var footTr = document.createElement('tr');
            var footTd = document.createElement('td');
            footTd.textContent = "End Footer";
            footTr.appendChild(footTd);
            newFoot.appendChild(footTr);
            table7.tFoot = newFoot;

            var children = table7.children;
            var lastIdx = children.length - 1;
            assert(children[lastIdx].tagName === "TFOOT",
                "tFoot is appended as last child (last child is: '" + children[lastIdx].tagName + "')");
        }

        info("Tests cover: tFoot getter (with/without), setter (replace/remove), appended at end");

        // ========================================
        // table.createTFoot() / table.deleteTFoot() tests
        // ========================================
        info("--- table.createTFoot() / table.deleteTFoot() tests ---");

        // createTFoot returns existing tfoot when one exists
        if (table7 && table7.tFoot) {
            var existingTFoot = table7.tFoot;
            var created = table7.createTFoot();
            assert(created === existingTFoot,
                "createTFoot() returns existing tfoot (same object, not a new one)");
        }

        // createTFoot creates a new tfoot when none exists
        if (table8) {
            // table8 had its tfoot removed by earlier setter test
            assert(table8.tFoot === null,
                "table8 has no tfoot before createTFoot() (was: " + table8.tFoot + ")");
            var newFoot = table8.createTFoot();
            assert(newFoot !== null && newFoot !== undefined,
                "createTFoot() returns a non-null element");
            assert(newFoot.tagName === "TFOOT",
                "createTFoot() returns a TFOOT element (was: '" + newFoot.tagName + "')");
            assert(table8.tFoot !== null,
                "table.tFoot getter now returns the created tfoot");
        }

        // createTFoot appends at end of table
        if (table8 && table8.tFoot) {
            var children = table8.children;
            var lastIdx = children.length - 1;
            assert(children[lastIdx].tagName === "TFOOT",
                "createTFoot() appends tfoot as last child (last child is: '" + children[lastIdx].tagName + "')");
        }

        // deleteTFoot removes the tfoot
        if (table8) {
            table8.deleteTFoot();
            assert(table8.tFoot === null,
                "deleteTFoot() removes the tfoot (table.tFoot is now: " + table8.tFoot + ")");
        }

        // deleteTFoot on table without tfoot does nothing (no error)
        if (table5) {
            table5.deleteTFoot();
            assert(table5.tFoot === null,
                "deleteTFoot() on table without tfoot does not throw (tFoot: " + table5.tFoot + ")");
        }

        // createTFoot then set text, verify content
        if (table8) {
            var foot = table8.createTFoot();
            foot.textContent = "Dynamic Footer";
            assert(table8.tFoot.textContent === "Dynamic Footer",
                "createTFoot() element is writable (text: '" + table8.tFoot.textContent + "')");
            table8.deleteTFoot();
        }

        info("Tests cover: createTFoot (existing/new), appended at end, deleteTFoot (with/without)");
    </script>

    <!-- ============================================ -->
    <!-- table.tBodies tests                          -->
    <!-- ============================================ -->
    <h2>table.tBodies</h2>

    <!-- Table with multiple tbody elements -->
    <table id="tBodies-1">
        <thead><tr><td>Head</td></tr></thead>
        <tbody id="tb1"><tr><td>Body 1</td></tr></tbody>
        <tbody id="tb2"><tr><td>Body 2</td></tr></tbody>
        <tfoot><tr><td>Foot</td></tr></tfoot>
    </table>

    <!-- Table with no tbody -->
    <table id="tBodies-2">
        <tr><td>No explicit tbody</td></tr>
    </table>

    <!-- Table with single tbody -->
    <table id="tBodies-3">
        <tbody id="tb3"><tr><td>Only body</td></tr></tbody>
    </table>

    <!-- Empty table -->
    <table id="tBodies-4"></table>

    <script>
        info("--- table.tBodies tests ---");

        var tbTable1 = document.getElementById("tBodies-1");
        var tbTable2 = document.getElementById("tBodies-2");
        var tbTable3 = document.getElementById("tBodies-3");
        var tbTable4 = document.getElementById("tBodies-4");

        // tBodies returns collection of tbody elements
        if (tbTable1) {
            assert(tbTable1.tBodies !== null && tbTable1.tBodies !== undefined,
                "tBodies is not null/undefined");
            assert(tbTable1.tBodies.length === 2,
                "table with 2 tbody elements has tBodies.length === 2 (got: " + tbTable1.tBodies.length + ")");
        }

        // tBodies elements have correct tagName
        if (tbTable1 && tbTable1.tBodies.length === 2) {
            assert(tbTable1.tBodies[0].tagName === "TBODY",
                "tBodies[0].tagName === 'TBODY' (got: '" + tbTable1.tBodies[0].tagName + "')");
            assert(tbTable1.tBodies[1].tagName === "TBODY",
                "tBodies[1].tagName === 'TBODY' (got: '" + tbTable1.tBodies[1].tagName + "')");
        }

        // tBodies elements are in document order
        if (tbTable1 && tbTable1.tBodies.length === 2) {
            assert(tbTable1.tBodies[0].id === "tb1",
                "tBodies[0] is first tbody (id: '" + tbTable1.tBodies[0].id + "')");
            assert(tbTable1.tBodies[1].id === "tb2",
                "tBodies[1] is second tbody (id: '" + tbTable1.tBodies[1].id + "')");
        }

        // tBodies on table with no explicit tbody - parser inserts implicit tbody around <tr>
        if (tbTable2) {
            assert(tbTable2.tBodies.length === 1,
                "table with implicit tbody has tBodies.length === 1 (got: " + tbTable2.tBodies.length + ")");
        }

        // tBodies on table with single tbody
        if (tbTable3) {
            assert(tbTable3.tBodies.length === 1,
                "table with 1 tbody has tBodies.length === 1 (got: " + tbTable3.tBodies.length + ")");
            assert(tbTable3.tBodies[0].id === "tb3",
                "single tbody has correct id (got: '" + tbTable3.tBodies[0].id + "')");
        }

        // tBodies on empty table
        if (tbTable4) {
            assert(tbTable4.tBodies.length === 0,
                "empty table has tBodies.length === 0 (got: " + tbTable4.tBodies.length + ")");
        }

        // tBodies does not include thead or tfoot
        if (tbTable1) {
            var allTbodies = tbTable1.tBodies;
            var foundNonTbody = false;
            for (var i = 0; i < allTbodies.length; i++) {
                if (allTbodies[i].tagName !== "TBODY") {
                    foundNonTbody = true;
                }
            }
            assert(!foundNonTbody,
                "tBodies only contains tbody elements, not thead/tfoot");
        }

        info("Tests cover: tBodies (multiple, single, none, empty, ordering, excludes thead/tfoot)");
    </script>

    <!-- ============================================ -->
    <!-- table.createTBody() tests                    -->
    <!-- ============================================ -->
    <h2>table.createTBody()</h2>

    <!-- Table with existing tbody -->
    <table id="ctb-1">
        <thead><tr><td>Head</td></tr></thead>
        <tbody><tr><td>Existing Body</td></tr></tbody>
        <tfoot><tr><td>Foot</td></tr></tfoot>
    </table>

    <!-- Empty table -->
    <table id="ctb-2"></table>

    <!-- Table with multiple tbodies -->
    <table id="ctb-3">
        <tbody id="ctb3-first"><tr><td>First</td></tr></tbody>
        <tbody id="ctb3-second"><tr><td>Second</td></tr></tbody>
    </table>

    <script>
        info("--- table.createTBody() tests ---");

        var ctbTable1 = document.getElementById("ctb-1");
        var ctbTable2 = document.getElementById("ctb-2");
        var ctbTable3 = document.getElementById("ctb-3");

        // createTBody always creates a new element (never returns existing)
        if (ctbTable1) {
            var beforeCount = ctbTable1.tBodies.length;
            var newBody = ctbTable1.createTBody();
            assert(newBody !== null && newBody !== undefined,
                "createTBody() returns an element");
            assert(newBody.tagName === "TBODY",
                "createTBody() returns a TBODY element (got: '" + newBody.tagName + "')");
            assert(ctbTable1.tBodies.length === beforeCount + 1,
                "createTBody() adds a new tbody (count: " + beforeCount + " -> " + ctbTable1.tBodies.length + ")");
        }

        // createTBody inserts after the last tbody (before tfoot)
        if (ctbTable1) {
            var children = ctbTable1.children;
            var tbodyIndices = [];
            var tfootIdx = -1;
            for (var i = 0; i < children.length; i++) {
                if (children[i].tagName === "TBODY") tbodyIndices.push(i);
                if (children[i].tagName === "TFOOT") tfootIdx = i;
            }
            var lastTbodyIdx = tbodyIndices[tbodyIndices.length - 1];
            assert(tfootIdx > lastTbodyIdx,
                "new tbody is inserted before tfoot (lastTbody: " + lastTbodyIdx + ", tfoot: " + tfootIdx + ")");
        }

        // createTBody on empty table
        if (ctbTable2) {
            var newBody2 = ctbTable2.createTBody();
            assert(ctbTable2.tBodies.length === 1,
                "createTBody() on empty table creates first tbody (count: " + ctbTable2.tBodies.length + ")");
        }

        // createTBody with multiple existing tbodies inserts after the last one
        if (ctbTable3) {
            var newBody3 = ctbTable3.createTBody();
            var bodies = ctbTable3.tBodies;
            assert(bodies.length === 3,
                "createTBody() adds third tbody (count: " + bodies.length + ")");
            assert(bodies[0].id === "ctb3-first",
                "first tbody unchanged (id: '" + bodies[0].id + "')");
            assert(bodies[1].id === "ctb3-second",
                "second tbody unchanged (id: '" + bodies[1].id + "')");
            assert(bodies[2] === newBody3,
                "new tbody is last in tBodies collection");
        }

        // Calling createTBody multiple times creates multiple tbodies
        if (ctbTable2) {
            var before = ctbTable2.tBodies.length;
            ctbTable2.createTBody();
            ctbTable2.createTBody();
            assert(ctbTable2.tBodies.length === before + 2,
                "calling createTBody() twice adds 2 tbodies (count: " + ctbTable2.tBodies.length + ")");
        }

        info("Tests cover: createTBody (always new, insertion after last tbody, empty table, multiple calls)");
    </script>

    <!-- ============================================ -->
    <!-- table.rows tests                              -->
    <!-- ============================================ -->
    <h2>table.rows</h2>

    <!-- Table with thead, tbody, tfoot -->
    <table id="rows-1">
        <thead><tr id="r1-h1"><td>Head 1</td></tr></thead>
        <tbody>
            <tr id="r1-b1"><td>Body 1</td></tr>
            <tr id="r1-b2"><td>Body 2</td></tr>
        </tbody>
        <tfoot><tr id="r1-f1"><td>Foot 1</td></tr></tfoot>
    </table>

    <!-- Table with only tbody rows -->
    <table id="rows-2">
        <tbody>
            <tr id="r2-b1"><td>Row 1</td></tr>
            <tr id="r2-b2"><td>Row 2</td></tr>
        </tbody>
    </table>

    <!-- Table with implicit tbody (parser wraps tr in tbody) -->
    <table id="rows-3">
        <tr id="r3-1"><td>Implicit 1</td></tr>
        <tr id="r3-2"><td>Implicit 2</td></tr>
    </table>

    <!-- Empty table -->
    <table id="rows-4"></table>

    <!-- Table with multiple tbodies -->
    <table id="rows-5">
        <thead><tr id="r5-h1"><td>Head</td></tr></thead>
        <tbody>
            <tr id="r5-b1"><td>Body A1</td></tr>
        </tbody>
        <tbody>
            <tr id="r5-b2"><td>Body B1</td></tr>
            <tr id="r5-b3"><td>Body B2</td></tr>
        </tbody>
        <tfoot><tr id="r5-f1"><td>Foot</td></tr></tfoot>
    </table>

    <!-- Table with tfoot before tbody in DOM (tests ordering) -->
    <table id="rows-6">
        <thead><tr id="r6-h1"><td>Head</td></tr></thead>
        <tfoot><tr id="r6-f1"><td>Foot</td></tr></tfoot>
        <tbody><tr id="r6-b1"><td>Body</td></tr></tbody>
    </table>

    <!-- Table with thead only -->
    <table id="rows-7">
        <thead>
            <tr id="r7-h1"><td>Header 1</td></tr>
            <tr id="r7-h2"><td>Header 2</td></tr>
        </thead>
    </table>

    <script>
        info("--- table.rows tests ---");

        var rowsT1 = document.getElementById("rows-1");
        var rowsT2 = document.getElementById("rows-2");
        var rowsT3 = document.getElementById("rows-3");
        var rowsT4 = document.getElementById("rows-4");
        var rowsT5 = document.getElementById("rows-5");
        var rowsT6 = document.getElementById("rows-6");
        var rowsT7 = document.getElementById("rows-7");

        // Basic: rows is not null/undefined
        if (rowsT1) {
            assert(rowsT1.rows !== null && rowsT1.rows !== undefined,
                "table.rows is not null/undefined");
        }

        // Row count: thead(1) + tbody(2) + tfoot(1) = 4
        if (rowsT1) {
            assert(rowsT1.rows.length === 4,
                "table with thead(1)+tbody(2)+tfoot(1) has rows.length === 4 (got: " + rowsT1.rows.length + ")");
        }

        // Ordering: thead rows come first
        if (rowsT1 && rowsT1.rows.length === 4) {
            assert(rowsT1.rows[0].id === "r1-h1",
                "rows[0] is thead row (id: '" + rowsT1.rows[0].id + "')");
        }

        // Ordering: tbody rows come in the middle
        if (rowsT1 && rowsT1.rows.length === 4) {
            assert(rowsT1.rows[1].id === "r1-b1",
                "rows[1] is first tbody row (id: '" + rowsT1.rows[1].id + "')");
            assert(rowsT1.rows[2].id === "r1-b2",
                "rows[2] is second tbody row (id: '" + rowsT1.rows[2].id + "')");
        }

        // Ordering: tfoot rows come last
        if (rowsT1 && rowsT1.rows.length === 4) {
            assert(rowsT1.rows[3].id === "r1-f1",
                "rows[3] is tfoot row (id: '" + rowsT1.rows[3].id + "')");
        }

        // All rows have TR tagName
        if (rowsT1) {
            var allTR = true;
            for (var i = 0; i < rowsT1.rows.length; i++) {
                if (rowsT1.rows[i].tagName !== "TR") allTR = false;
            }
            assert(allTR, "all entries in rows have tagName 'TR'");
        }

        // Table with only tbody rows
        if (rowsT2) {
            assert(rowsT2.rows.length === 2,
                "table with only tbody has rows.length === 2 (got: " + rowsT2.rows.length + ")");
            assert(rowsT2.rows[0].id === "r2-b1",
                "tbody-only rows[0] is correct (id: '" + rowsT2.rows[0].id + "')");
            assert(rowsT2.rows[1].id === "r2-b2",
                "tbody-only rows[1] is correct (id: '" + rowsT2.rows[1].id + "')");
        }

        // Table with implicit tbody (parser inserts tbody around bare tr)
        if (rowsT3) {
            assert(rowsT3.rows.length === 2,
                "table with implicit tbody has rows.length === 2 (got: " + rowsT3.rows.length + ")");
            assert(rowsT3.rows[0].id === "r3-1",
                "implicit tbody rows[0] correct (id: '" + rowsT3.rows[0].id + "')");
        }

        // Empty table
        if (rowsT4) {
            assert(rowsT4.rows.length === 0,
                "empty table has rows.length === 0 (got: " + rowsT4.rows.length + ")");
        }

        // Multiple tbodies: rows collected in tree order across all tbodies
        if (rowsT5) {
            assert(rowsT5.rows.length === 5,
                "table with thead(1)+tbody(1)+tbody(2)+tfoot(1) has rows.length === 5 (got: " + rowsT5.rows.length + ")");
            assert(rowsT5.rows[0].id === "r5-h1",
                "multi-tbody rows[0] is thead row (id: '" + rowsT5.rows[0].id + "')");
            assert(rowsT5.rows[1].id === "r5-b1",
                "multi-tbody rows[1] is first tbody row (id: '" + rowsT5.rows[1].id + "')");
            assert(rowsT5.rows[2].id === "r5-b2",
                "multi-tbody rows[2] is second tbody first row (id: '" + rowsT5.rows[2].id + "')");
            assert(rowsT5.rows[3].id === "r5-b3",
                "multi-tbody rows[3] is second tbody second row (id: '" + rowsT5.rows[3].id + "')");
            assert(rowsT5.rows[4].id === "r5-f1",
                "multi-tbody rows[4] is tfoot row (id: '" + rowsT5.rows[4].id + "')");
        }

        // tfoot before tbody in DOM: rows still ordered thead -> tbody -> tfoot
        if (rowsT6) {
            assert(rowsT6.rows.length === 3,
                "table with reordered sections has rows.length === 3 (got: " + rowsT6.rows.length + ")");
            assert(rowsT6.rows[0].id === "r6-h1",
                "reordered rows[0] is thead row (id: '" + rowsT6.rows[0].id + "')");
            assert(rowsT6.rows[1].id === "r6-b1",
                "reordered rows[1] is tbody row (id: '" + rowsT6.rows[1].id + "')");
            assert(rowsT6.rows[2].id === "r6-f1",
                "reordered rows[2] is tfoot row (id: '" + rowsT6.rows[2].id + "')");
        }

        // Table with only thead
        if (rowsT7) {
            assert(rowsT7.rows.length === 2,
                "thead-only table has rows.length === 2 (got: " + rowsT7.rows.length + ")");
            assert(rowsT7.rows[0].id === "r7-h1",
                "thead-only rows[0] correct (id: '" + rowsT7.rows[0].id + "')");
            assert(rowsT7.rows[1].id === "r7-h2",
                "thead-only rows[1] correct (id: '" + rowsT7.rows[1].id + "')");
        }

        info("Tests cover: rows (count, ordering thead/tbody/tfoot, multiple tbodies, implicit tbody, empty, reordered DOM, thead-only)");
    </script>

    <!-- ============================================ -->
    <!-- table.insertRow() tests                       -->
    <!-- ============================================ -->
    <h2>table.insertRow()</h2>

    <!-- Table with all sections for insertRow -->
    <table id="ir-1">
        <thead><tr id="ir1-h1"><td>Head</td></tr></thead>
        <tbody>
            <tr id="ir1-b1"><td>Body 1</td></tr>
            <tr id="ir1-b2"><td>Body 2</td></tr>
        </tbody>
        <tfoot><tr id="ir1-f1"><td>Foot</td></tr></tfoot>
    </table>

    <!-- Empty table for insertRow -->
    <table id="ir-2"></table>

    <!-- Table with multiple tbodies for insertRow -->
    <table id="ir-3">
        <tbody><tr id="ir3-b1"><td>Body A</td></tr></tbody>
        <tbody><tr id="ir3-b2"><td>Body B</td></tr></tbody>
    </table>

    <script>
        info("--- table.insertRow() tests ---");

        var irT1 = document.getElementById("ir-1");
        var irT2 = document.getElementById("ir-2");
        var irT3 = document.getElementById("ir-3");

        // insertRow(-1) appends to parent of last row in table.rows
        if (irT1) {
            var before = irT1.rows.length;
            var newRow = irT1.insertRow(-1);
            assert(newRow !== null && newRow !== undefined,
                "insertRow(-1) returns an element");
            assert(newRow.tagName === "TR",
                "insertRow(-1) returns a TR element (got: '" + newRow.tagName + "')");
            assert(irT1.rows.length === before + 1,
                "insertRow(-1) increases row count (was: " + before + ", now: " + irT1.rows.length + ")");
        }

        // insertRow(-1) new row is now the last row (appended to tfoot, parent of last row)
        if (irT1) {
            var rows = irT1.rows;
            var lastIdx = rows.length - 1;
            assert(rows[lastIdx] !== null && rows[lastIdx].id === "",
                "after insertRow(-1), new row is last in rows (parent is tfoot of last row)");
            assert(rows[lastIdx - 1].id === "ir1-f1",
                "original tfoot row is second-to-last (id: '" + rows[lastIdx - 1].id + "')");
        }

        // insertRow() with no args same as insertRow(-1)
        if (irT1) {
            var before = irT1.rows.length;
            var newRow = irT1.insertRow();
            assert(irT1.rows.length === before + 1,
                "insertRow() with no args appends row (count: " + before + " -> " + irT1.rows.length + ")");
        }

        // insertRow(0) inserts before first row
        if (irT1) {
            var newRow = irT1.insertRow(0);
            newRow.id = "ir1-inserted-0";
            assert(irT1.rows[0].id === "ir1-inserted-0",
                "insertRow(0) new row is first in rows (got: '" + irT1.rows[0].id + "')");
        }

        // insertRow(N) inserts at specific position
        if (irT1) {
            var before = irT1.rows.length;
            var newRow = irT1.insertRow(2);
            newRow.id = "ir1-inserted-2";
            assert(irT1.rows[2].id === "ir1-inserted-2",
                "insertRow(2) new row is at index 2 (got: '" + irT1.rows[2].id + "')");
            assert(irT1.rows.length === before + 1,
                "insertRow(2) increases row count by 1");
        }

        // insertRow on empty table creates tbody and row
        if (irT2) {
            var newRow = irT2.insertRow();
            assert(newRow !== null && newRow !== undefined,
                "insertRow() on empty table returns an element");
            assert(newRow.tagName === "TR",
                "insertRow() on empty table returns TR");
            assert(irT2.rows.length === 1,
                "empty table now has 1 row (got: " + irT2.rows.length + ")");
            assert(irT2.tBodies.length === 1,
                "insertRow() on empty table created a tbody (got: " + irT2.tBodies.length + ")");
        }

        // insertRow(rows.length) same as insertRow(-1)
        if (irT3) {
            var len = irT3.rows.length;
            var newRow = irT3.insertRow(len);
            assert(irT3.rows.length === len + 1,
                "insertRow(rows.length) appends row (was: " + len + ", now: " + irT3.rows.length + ")");
        }

        info("Tests cover: insertRow(-1), insertRow(), insertRow(0), insertRow(N), empty table, insertRow(rows.length)");
    </script>

    <!-- ============================================ -->
    <!-- table.deleteRow() tests                       -->
    <!-- ============================================ -->
    <h2>table.deleteRow()</h2>

    <!-- Table with all sections for deleteRow -->
    <table id="dr-1">
        <thead><tr id="dr1-h1"><td>Head</td></tr></thead>
        <tbody>
            <tr id="dr1-b1"><td>Body 1</td></tr>
            <tr id="dr1-b2"><td>Body 2</td></tr>
            <tr id="dr1-b3"><td>Body 3</td></tr>
        </tbody>
        <tfoot><tr id="dr1-f1"><td>Foot</td></tr></tfoot>
    </table>

    <!-- Table for deleteRow(-1) -->
    <table id="dr-2">
        <tbody>
            <tr id="dr2-b1"><td>Row 1</td></tr>
            <tr id="dr2-b2"><td>Row 2</td></tr>
            <tr id="dr2-b3"><td>Row 3</td></tr>
        </tbody>
    </table>

    <!-- Table with single row for deletion -->
    <table id="dr-3">
        <tbody><tr id="dr3-b1"><td>Only Row</td></tr></tbody>
    </table>

    <script>
        info("--- table.deleteRow() tests ---");

        var drT1 = document.getElementById("dr-1");
        var drT2 = document.getElementById("dr-2");
        var drT3 = document.getElementById("dr-3");

        // deleteRow(index) removes the correct row
        if (drT1) {
            var before = drT1.rows.length;
            drT1.deleteRow(1);
            assert(drT1.rows.length === before - 1,
                "deleteRow(1) decreases row count (was: " + before + ", now: " + drT1.rows.length + ")");
            var found = false;
            for (var i = 0; i < drT1.rows.length; i++) {
                if (drT1.rows[i].id === "dr1-b1") found = true;
            }
            assert(!found,
                "deleteRow(1) removed row 'dr1-b1' from collection");
        }

        // deleteRow(0) removes first row (thead row)
        if (drT1) {
            var before = drT1.rows.length;
            drT1.deleteRow(0);
            assert(drT1.rows.length === before - 1,
                "deleteRow(0) removes first row");
            assert(drT1.rows[0].id === "dr1-b2",
                "after deleteRow(0), new first row is 'dr1-b2' (got: '" + drT1.rows[0].id + "')");
        }

        // deleteRow removes tfoot row by index
        if (drT1) {
            var lastIdx = drT1.rows.length - 1;
            var lastId = drT1.rows[lastIdx].id;
            assert(lastId === "dr1-f1",
                "last row is tfoot row before deletion (got: '" + lastId + "')");
            drT1.deleteRow(lastIdx);
            var found = false;
            for (var i = 0; i < drT1.rows.length; i++) {
                if (drT1.rows[i].id === "dr1-f1") found = true;
            }
            assert(!found,
                "deleteRow(lastIdx) removed tfoot row 'dr1-f1'");
        }

        // deleteRow(-1) removes last row
        if (drT2) {
            var before = drT2.rows.length;
            drT2.deleteRow(-1);
            assert(drT2.rows.length === before - 1,
                "deleteRow(-1) decreases row count (was: " + before + ", now: " + drT2.rows.length + ")");
            var found = false;
            for (var i = 0; i < drT2.rows.length; i++) {
                if (drT2.rows[i].id === "dr2-b3") found = true;
            }
            assert(!found,
                "deleteRow(-1) removed last row 'dr2-b3'");
        }

        // deleteRow(-1) again removes new last row
        if (drT2) {
            drT2.deleteRow(-1);
            assert(drT2.rows.length === 1,
                "second deleteRow(-1) leaves 1 row (got: " + drT2.rows.length + ")");
            assert(drT2.rows[0].id === "dr2-b1",
                "remaining row is 'dr2-b1' (got: '" + drT2.rows[0].id + "')");
        }

        // deleteRow on single-row table empties it
        if (drT3) {
            assert(drT3.rows.length === 1,
                "single-row table starts with 1 row");
            drT3.deleteRow(0);
            assert(drT3.rows.length === 0,
                "deleteRow(0) on single-row table leaves 0 rows (got: " + drT3.rows.length + ")");
        }

        info("Tests cover: deleteRow(index), deleteRow(0), deleteRow(-1), tfoot row deletion, repeated deletion, single-row table");
    </script>

    <!-- ============================================ -->
    <!-- td.colSpan / td.rowSpan tests (WHATWG 4.9.11) -->
    <!-- ============================================ -->
    <h2>HTMLTableCellElement - colSpan / rowSpan (WHATWG 4.9.11)</h2>

    <table id="span-1">
        <tr>
            <td id="sp-a" colspan="2" rowspan="3">A</td>
            <td id="sp-b">B</td>
        </tr>
        <tr><td id="sp-c">C</td></tr>
        <tr><td id="sp-d">D</td></tr>
    </table>

    <table id="span-2">
        <tr>
            <td id="sp-default">No span attrs</td>
            <td id="sp-one" colspan="1" rowspan="1">Explicit 1</td>
        </tr>
    </table>

    <script>
        info("--- td.colSpan / td.rowSpan property tests (WHATWG 4.9.11) ---");

        var spA = document.getElementById("sp-a");
        var spB = document.getElementById("sp-b");
        var spDefault = document.getElementById("sp-default");
        var spOne = document.getElementById("sp-one");

        // colSpan getter returns number
        if (spA) {
            assert(spA.colSpan === 2,
                "td.colSpan getter returns 2 (got: " + spA.colSpan + ")");
        }

        // rowSpan getter returns number
        if (spA) {
            assert(spA.rowSpan === 3,
                "td.rowSpan getter returns 3 (got: " + spA.rowSpan + ")");
        }

        // Default colSpan is 1 when no attribute
        if (spDefault) {
            assert(spDefault.colSpan === 1,
                "td.colSpan defaults to 1 when no attribute (got: " + spDefault.colSpan + ")");
        }

        // Default rowSpan is 1 when no attribute
        if (spDefault) {
            assert(spDefault.rowSpan === 1,
                "td.rowSpan defaults to 1 when no attribute (got: " + spDefault.rowSpan + ")");
        }

        // Explicit colspan="1" returns 1
        if (spOne) {
            assert(spOne.colSpan === 1,
                "td.colSpan returns 1 for explicit colspan='1' (got: " + spOne.colSpan + ")");
            assert(spOne.rowSpan === 1,
                "td.rowSpan returns 1 for explicit rowspan='1' (got: " + spOne.rowSpan + ")");
        }

        // colSpan is a number, not a string
        if (spA) {
            assert(typeof spA.colSpan === "number",
                "td.colSpan is typeof number (got: " + typeof spA.colSpan + ")");
            assert(typeof spA.rowSpan === "number",
                "td.rowSpan is typeof number (got: " + typeof spA.rowSpan + ")");
        }

        // colSpan setter
        if (spB) {
            spB.colSpan = 4;
            assert(spB.colSpan === 4,
                "td.colSpan setter works (set 4, got: " + spB.colSpan + ")");
            assert(spB.getAttribute("colspan") === "4",
                "td.colSpan setter reflects to attribute (got: '" + spB.getAttribute("colspan") + "')");
        }

        // rowSpan setter
        if (spB) {
            spB.rowSpan = 5;
            assert(spB.rowSpan === 5,
                "td.rowSpan setter works (set 5, got: " + spB.rowSpan + ")");
            assert(spB.getAttribute("rowspan") === "5",
                "td.rowSpan setter reflects to attribute (got: '" + spB.getAttribute("rowspan") + "')");
        }

        // colSpan clamped to minimum 1
        if (spB) {
            spB.colSpan = 0;
            assert(spB.colSpan >= 1,
                "td.colSpan clamped to >= 1 when set to 0 (got: " + spB.colSpan + ")");
        }

        // colSpan clamped to maximum 1000
        if (spB) {
            spB.colSpan = 2000;
            assert(spB.colSpan <= 1000,
                "td.colSpan clamped to <= 1000 when set to 2000 (got: " + spB.colSpan + ")");
        }

        // rowSpan clamped to maximum 65534
        if (spB) {
            spB.rowSpan = 99999;
            assert(spB.rowSpan <= 65534,
                "td.rowSpan clamped to <= 65534 when set to 99999 (got: " + spB.rowSpan + ")");
        }

        info("Tests cover: colSpan/rowSpan getter (with/without attr), type check, setter, attribute reflection, clamping");
    </script>

    <!-- ============================================ -->
    <!-- td.cellIndex tests (WHATWG 4.9.11)           -->
    <!-- ============================================ -->
    <h2>Visual Tests - HTMLTableCellElement.cellIndex (WHATWG 4.9.11)</h2>

    <h3>Test: Three td cells in a row</h3>
    <div class="test-box">
        <table id="ci-1">
            <tr id="ci-row1">
                <td id="ci-a">A</td>
                <td id="ci-b">B</td>
                <td id="ci-c">C</td>
            </tr>
        </table>
    </div>
    <p>Expected: cellIndex 0, 1, 2 for cells A, B, C respectively</p>

    <h3>Test: Mixed th and td cells in a row</h3>
    <div class="test-box">
        <table id="ci-2">
            <tr id="ci-row2">
                <th id="ci-h1">Name</th>
                <th id="ci-h2">Age</th>
                <td id="ci-d">Data</td>
            </tr>
        </table>
    </div>
    <p>Expected: cellIndex counts th and td together  Name=0, Age=1, Data=2</p>

    <h3>Test: Single cell in a row</h3>
    <div class="test-box">
        <table id="ci-3">
            <tr id="ci-row3">
                <td id="ci-only">Only cell</td>
            </tr>
        </table>
    </div>
    <p>Expected: Only cell has cellIndex 0</p>

    <h2>JavaScript Tests - HTMLTableCellElement.cellIndex (WHATWG 4.9.11)</h2>

    <script>
        info("--- td.cellIndex property tests (WHATWG 4.9.11) ---");

        var ciA = document.getElementById("ci-a");
        var ciB = document.getElementById("ci-b");
        var ciC = document.getElementById("ci-c");
        var ciH1 = document.getElementById("ci-h1");
        var ciH2 = document.getElementById("ci-h2");
        var ciD = document.getElementById("ci-d");
        var ciOnly = document.getElementById("ci-only");

        // cellIndex returns 0 for first cell
        if (ciA) {
            assert(ciA.cellIndex === 0,
                "first td.cellIndex === 0 (got: " + ciA.cellIndex + ")");
        }

        // cellIndex returns 1 for second cell
        if (ciB) {
            assert(ciB.cellIndex === 1,
                "second td.cellIndex === 1 (got: " + ciB.cellIndex + ")");
        }

        // cellIndex returns 2 for third cell
        if (ciC) {
            assert(ciC.cellIndex === 2,
                "third td.cellIndex === 2 (got: " + ciC.cellIndex + ")");
        }

        // cellIndex works on th elements too
        if (ciH1) {
            assert(ciH1.cellIndex === 0,
                "first th.cellIndex === 0 (got: " + ciH1.cellIndex + ")");
        }
        if (ciH2) {
            assert(ciH2.cellIndex === 1,
                "second th.cellIndex === 1 (got: " + ciH2.cellIndex + ")");
        }

        // cellIndex for td after th elements
        if (ciD) {
            assert(ciD.cellIndex === 2,
                "td after 2 th elements has cellIndex === 2 (got: " + ciD.cellIndex + ")");
        }

        // cellIndex is a number
        if (ciA) {
            assert(typeof ciA.cellIndex === "number",
                "cellIndex is typeof number (got: " + typeof ciA.cellIndex + ")");
        }

        // cellIndex for only cell in row
        if (ciOnly) {
            assert(ciOnly.cellIndex === 0,
                "only cell in row has cellIndex === 0 (got: " + ciOnly.cellIndex + ")");
        }

        // cellIndex is read-only (setting it should not change value)
        if (ciA) {
            ciA.cellIndex = 99;
            assert(ciA.cellIndex === 0,
                "cellIndex is read-only (still 0 after setting to 99, got: " + ciA.cellIndex + ")");
        }

        info("Tests cover: cellIndex (position, mixed td/th, type check, single cell, read-only)");
    </script>

    <h2>Visual Tests - tr.cells (WHATWG 4.9.8)</h2>

    <h3>Test: Row with mixed th and td cells</h3>
    <div class="test-box">
        <table id="cellsT1">
            <tr id="c1-header">
                <th>Name</th>
                <th>Age</th>
                <th>City</th>
            </tr>
            <tr id="c1-data">
                <td>Alice</td>
                <td>30</td>
                <td>NYC</td>
            </tr>
        </table>
    </div>
    <p>Expected: Header row with 3 th cells, data row with 3 td cells</p>

    <h3>Test: Row with only th cells</h3>
    <div class="test-box">
        <table id="cellsT2">
            <tr id="c2-allth">
                <th>Col A</th>
                <th>Col B</th>
            </tr>
        </table>
    </div>
    <p>Expected: Row with 2 th cells</p>

    <h3>Test: Empty row (no cells)</h3>
    <div class="test-box">
        <table id="cellsT3">
            <tr id="c3-empty"></tr>
        </table>
    </div>
    <p>Expected: Empty row with 0 cells</p>

    <h3>Test: Row inside thead/tbody/tfoot sections</h3>
    <div class="test-box">
        <table id="cellsT4">
            <thead>
                <tr id="c4-thead">
                    <th>Product</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                <tr id="c4-tbody">
                    <td>Widget</td>
                    <td>$5.00</td>
                </tr>
            </tbody>
            <tfoot>
                <tr id="c4-tfoot">
                    <td>Total</td>
                    <td>$5.00</td>
                </tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: tr.cells works regardless of which section (thead/tbody/tfoot) the row is in</p>

    <h2>JavaScript Tests - tr.cells (WHATWG 4.9.8)</h2>
    <script>
        info("--- tr.cells tests (WHATWG 4.9.8) ---");

        var c1Header = document.getElementById('c1-header');
        var c1Data   = document.getElementById('c1-data');
        var c2AllTh  = document.getElementById('c2-allth');
        var c3Empty  = document.getElementById('c3-empty');
        var c4Thead  = document.getElementById('c4-thead');
        var c4Tbody  = document.getElementById('c4-tbody');
        var c4Tfoot  = document.getElementById('c4-tfoot');

        // Basic existence
        if (c1Header) {
            assert(c1Header.cells !== null && c1Header.cells !== undefined,
                "tr.cells is not null/undefined");
        }

        // Header row has 3 th cells
        if (c1Header) {
            assert(c1Header.cells.length === 3,
                "header row has cells.length === 3 (got: " + c1Header.cells.length + ")");
        }

        // All cells in header row are TH
        if (c1Header) {
            var allTH = true;
            for (var i = 0; i < c1Header.cells.length; i++) {
                if (c1Header.cells[i].tagName !== "TH") allTH = false;
            }
            assert(allTH, "all cells in header row have tagName 'TH'");
        }

        // Data row has 3 td cells
        if (c1Data) {
            assert(c1Data.cells.length === 3,
                "data row has cells.length === 3 (got: " + c1Data.cells.length + ")");
        }

        // All cells in data row are TD
        if (c1Data) {
            var allTD = true;
            for (var i = 0; i < c1Data.cells.length; i++) {
                if (c1Data.cells[i].tagName !== "TD") allTD = false;
            }
            assert(allTD, "all cells in data row have tagName 'TD'");
        }

        // Cell content in document order
        if (c1Data) {
            assert(c1Data.cells[0].textContent === "Alice",
                "cells[0].textContent is 'Alice' (got: '" + c1Data.cells[0].textContent + "')");
            assert(c1Data.cells[1].textContent === "30",
                "cells[1].textContent is '30' (got: '" + c1Data.cells[1].textContent + "')");
            assert(c1Data.cells[2].textContent === "NYC",
                "cells[2].textContent is 'NYC' (got: '" + c1Data.cells[2].textContent + "')");
        }

        // Row with only th cells
        if (c2AllTh) {
            assert(c2AllTh.cells.length === 2,
                "all-th row has cells.length === 2 (got: " + c2AllTh.cells.length + ")");
        }

        // Empty row has 0 cells
        if (c3Empty) {
            assert(c3Empty.cells.length === 0,
                "empty row has cells.length === 0 (got: " + c3Empty.cells.length + ")");
        }

        // tr.cells works inside thead
        if (c4Thead) {
            assert(c4Thead.cells.length === 2,
                "thead row has cells.length === 2 (got: " + c4Thead.cells.length + ")");
            assert(c4Thead.cells[0].tagName === "TH",
                "thead row cells are TH (got: '" + c4Thead.cells[0].tagName + "')");
        }

        // tr.cells works inside tbody
        if (c4Tbody) {
            assert(c4Tbody.cells.length === 2,
                "tbody row has cells.length === 2 (got: " + c4Tbody.cells.length + ")");
            assert(c4Tbody.cells[0].tagName === "TD",
                "tbody row cells are TD (got: '" + c4Tbody.cells[0].tagName + "')");
        }

        // tr.cells works inside tfoot
        if (c4Tfoot) {
            assert(c4Tfoot.cells.length === 2,
                "tfoot row has cells.length === 2 (got: " + c4Tfoot.cells.length + ")");
            assert(c4Tfoot.cells[0].textContent === "Total",
                "tfoot cells[0].textContent is 'Total' (got: '" + c4Tfoot.cells[0].textContent + "')");
        }

        info("Tests cover: existence, length, tagName (TH/TD), textContent order, empty row, thead/tbody/tfoot rows");
    </script>

    <h2>Visual Tests - tr.rowIndex (WHATWG 4.9.8)</h2>

    <h3>Test: Simple table with no sections</h3>
    <div class="test-box">
        <table id="riT1">
            <tr id="ri1-r0"><td>Row 0</td></tr>
            <tr id="ri1-r1"><td>Row 1</td></tr>
            <tr id="ri1-r2"><td>Row 2</td></tr>
        </table>
    </div>
    <p>Expected: 3 direct rows, rowIndex 0, 1, 2</p>

    <h3>Test: Table with thead, tbody, tfoot</h3>
    <div class="test-box">
        <table id="riT2">
            <thead>
                <tr id="ri2-head"><th>Header</th></tr>
            </thead>
            <tbody>
                <tr id="ri2-body1"><td>Data 1</td></tr>
                <tr id="ri2-body2"><td>Data 2</td></tr>
            </tbody>
            <tfoot>
                <tr id="ri2-foot"><td>Footer</td></tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: rowIndex counts across all sections: head=0, body1=1, body2=2, foot=3</p>

    <h3>Test: Table with multiple tbodies</h3>
    <div class="test-box">
        <table id="riT3">
            <tbody>
                <tr id="ri3-a"><td>A</td></tr>
            </tbody>
            <tbody>
                <tr id="ri3-b"><td>B</td></tr>
                <tr id="ri3-c"><td>C</td></tr>
            </tbody>
        </table>
    </div>
    <p>Expected: rowIndex continues across multiple tbody sections: a=0, b=1, c=2</p>

    <h3>Test: Single-row table</h3>
    <div class="test-box">
        <table id="riT4">
            <tr id="ri4-only"><td>Only row</td></tr>
        </table>
    </div>
    <p>Expected: Single row has rowIndex 0</p>

    <h3>Test: thead + tfoot, no tbody</h3>
    <div class="test-box">
        <table id="riT5">
            <thead>
                <tr id="ri5-head"><th>Head</th></tr>
            </thead>
            <tfoot>
                <tr id="ri5-foot"><td>Foot</td></tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: head=0, foot=1 (tfoot comes after thead even with no tbody)</p>

    <h2>JavaScript Tests - tr.rowIndex (WHATWG 4.9.8)</h2>
    <script>
        info("--- tr.rowIndex tests (WHATWG 4.9.8) ---");

        // Simple table - no sections
        var ri1R0 = document.getElementById('ri1-r0');
        var ri1R1 = document.getElementById('ri1-r1');
        var ri1R2 = document.getElementById('ri1-r2');

        if (ri1R0) {
            assert(ri1R0.rowIndex === 0,
                "simple table: first row has rowIndex === 0 (got: " + ri1R0.rowIndex + ")");
        }
        if (ri1R1) {
            assert(ri1R1.rowIndex === 1,
                "simple table: second row has rowIndex === 1 (got: " + ri1R1.rowIndex + ")");
        }
        if (ri1R2) {
            assert(ri1R2.rowIndex === 2,
                "simple table: third row has rowIndex === 2 (got: " + ri1R2.rowIndex + ")");
        }

        // Table with thead/tbody/tfoot
        var ri2Head  = document.getElementById('ri2-head');
        var ri2Body1 = document.getElementById('ri2-body1');
        var ri2Body2 = document.getElementById('ri2-body2');
        var ri2Foot  = document.getElementById('ri2-foot');

        if (ri2Head) {
            assert(ri2Head.rowIndex === 0,
                "sectioned table: thead row has rowIndex === 0 (got: " + ri2Head.rowIndex + ")");
        }
        if (ri2Body1) {
            assert(ri2Body1.rowIndex === 1,
                "sectioned table: first tbody row has rowIndex === 1 (got: " + ri2Body1.rowIndex + ")");
        }
        if (ri2Body2) {
            assert(ri2Body2.rowIndex === 2,
                "sectioned table: second tbody row has rowIndex === 2 (got: " + ri2Body2.rowIndex + ")");
        }
        if (ri2Foot) {
            assert(ri2Foot.rowIndex === 3,
                "sectioned table: tfoot row has rowIndex === 3 (got: " + ri2Foot.rowIndex + ")");
        }

        // Multiple tbodies
        var ri3A = document.getElementById('ri3-a');
        var ri3B = document.getElementById('ri3-b');
        var ri3C = document.getElementById('ri3-c');

        if (ri3A) {
            assert(ri3A.rowIndex === 0,
                "multi-tbody: first tbody row has rowIndex === 0 (got: " + ri3A.rowIndex + ")");
        }
        if (ri3B) {
            assert(ri3B.rowIndex === 1,
                "multi-tbody: second tbody first row has rowIndex === 1 (got: " + ri3B.rowIndex + ")");
        }
        if (ri3C) {
            assert(ri3C.rowIndex === 2,
                "multi-tbody: second tbody second row has rowIndex === 2 (got: " + ri3C.rowIndex + ")");
        }

        // Single-row table
        var ri4Only = document.getElementById('ri4-only');
        if (ri4Only) {
            assert(ri4Only.rowIndex === 0,
                "single-row table: only row has rowIndex === 0 (got: " + ri4Only.rowIndex + ")");
        }

        // thead + tfoot, no tbody
        var ri5Head = document.getElementById('ri5-head');
        var ri5Foot = document.getElementById('ri5-foot');

        if (ri5Head) {
            assert(ri5Head.rowIndex === 0,
                "thead+tfoot only: thead row has rowIndex === 0 (got: " + ri5Head.rowIndex + ")");
        }
        if (ri5Foot) {
            assert(ri5Foot.rowIndex === 1,
                "thead+tfoot only: tfoot row has rowIndex === 1 (got: " + ri5Foot.rowIndex + ")");
        }

        info("Tests cover: simple rows, thead/tbody/tfoot ordering, multiple tbodies, single-row table, thead+tfoot without tbody");
    </script>

    <h2>Visual Tests - tr.sectionRowIndex (WHATWG 4.9.8)</h2>

    <h3>Test: Direct rows in table (no sections)</h3>
    <div class="test-box">
        <table id="siT1">
            <tr id="si1-r0"><td>Row 0</td></tr>
            <tr id="si1-r1"><td>Row 1</td></tr>
            <tr id="si1-r2"><td>Row 2</td></tr>
        </table>
    </div>
    <p>Expected: Direct children of table, sectionRowIndex 0, 1, 2 (table acts as section)</p>

    <h3>Test: Rows in thead, tbody, tfoot each reset</h3>
    <div class="test-box">
        <table id="siT2">
            <thead>
                <tr id="si2-h0"><th>Header 1</th></tr>
                <tr id="si2-h1"><th>Header 2</th></tr>
            </thead>
            <tbody>
                <tr id="si2-b0"><td>Body 1</td></tr>
                <tr id="si2-b1"><td>Body 2</td></tr>
                <tr id="si2-b2"><td>Body 3</td></tr>
            </tbody>
            <tfoot>
                <tr id="si2-f0"><td>Foot 1</td></tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: thead resets (0,1), tbody resets (0,1,2), tfoot resets (0)</p>

    <h3>Test: Multiple tbodies each reset independently</h3>
    <div class="test-box">
        <table id="siT3">
            <tbody>
                <tr id="si3-a0"><td>A1</td></tr>
                <tr id="si3-a1"><td>A2</td></tr>
            </tbody>
            <tbody>
                <tr id="si3-b0"><td>B1</td></tr>
                <tr id="si3-b1"><td>B2</td></tr>
                <tr id="si3-b2"><td>B3</td></tr>
            </tbody>
        </table>
    </div>
    <p>Expected: First tbody (0,1), second tbody resets (0,1,2)</p>

    <h3>Test: Single row in a section</h3>
    <div class="test-box">
        <table id="siT4">
            <thead>
                <tr id="si4-only"><th>Only</th></tr>
            </thead>
        </table>
    </div>
    <p>Expected: Single row in thead has sectionRowIndex 0</p>

    <h2>JavaScript Tests - tr.sectionRowIndex (WHATWG 4.9.8)</h2>
    <script>
        info("--- tr.sectionRowIndex tests (WHATWG 4.9.8) ---");

        // Direct rows in table (table acts as section)
        var si1R0 = document.getElementById('si1-r0');
        var si1R1 = document.getElementById('si1-r1');
        var si1R2 = document.getElementById('si1-r2');

        if (si1R0) {
            assert(si1R0.sectionRowIndex === 0,
                "direct rows: first row has sectionRowIndex === 0 (got: " + si1R0.sectionRowIndex + ")");
        }
        if (si1R1) {
            assert(si1R1.sectionRowIndex === 1,
                "direct rows: second row has sectionRowIndex === 1 (got: " + si1R1.sectionRowIndex + ")");
        }
        if (si1R2) {
            assert(si1R2.sectionRowIndex === 2,
                "direct rows: third row has sectionRowIndex === 2 (got: " + si1R2.sectionRowIndex + ")");
        }

        // Rows in thead, tbody, tfoot each reset
        var si2H0 = document.getElementById('si2-h0');
        var si2H1 = document.getElementById('si2-h1');
        var si2B0 = document.getElementById('si2-b0');
        var si2B1 = document.getElementById('si2-b1');
        var si2B2 = document.getElementById('si2-b2');
        var si2F0 = document.getElementById('si2-f0');

        if (si2H0) {
            assert(si2H0.sectionRowIndex === 0,
                "thead: first row has sectionRowIndex === 0 (got: " + si2H0.sectionRowIndex + ")");
        }
        if (si2H1) {
            assert(si2H1.sectionRowIndex === 1,
                "thead: second row has sectionRowIndex === 1 (got: " + si2H1.sectionRowIndex + ")");
        }
        if (si2B0) {
            assert(si2B0.sectionRowIndex === 0,
                "tbody: first row resets to sectionRowIndex === 0 (got: " + si2B0.sectionRowIndex + ")");
        }
        if (si2B1) {
            assert(si2B1.sectionRowIndex === 1,
                "tbody: second row has sectionRowIndex === 1 (got: " + si2B1.sectionRowIndex + ")");
        }
        if (si2B2) {
            assert(si2B2.sectionRowIndex === 2,
                "tbody: third row has sectionRowIndex === 2 (got: " + si2B2.sectionRowIndex + ")");
        }
        if (si2F0) {
            assert(si2F0.sectionRowIndex === 0,
                "tfoot: first row resets to sectionRowIndex === 0 (got: " + si2F0.sectionRowIndex + ")");
        }

        // Multiple tbodies each reset
        var si3A0 = document.getElementById('si3-a0');
        var si3A1 = document.getElementById('si3-a1');
        var si3B0 = document.getElementById('si3-b0');
        var si3B1 = document.getElementById('si3-b1');
        var si3B2 = document.getElementById('si3-b2');

        if (si3A0) {
            assert(si3A0.sectionRowIndex === 0,
                "multi-tbody: first tbody row 0 has sectionRowIndex === 0 (got: " + si3A0.sectionRowIndex + ")");
        }
        if (si3A1) {
            assert(si3A1.sectionRowIndex === 1,
                "multi-tbody: first tbody row 1 has sectionRowIndex === 1 (got: " + si3A1.sectionRowIndex + ")");
        }
        if (si3B0) {
            assert(si3B0.sectionRowIndex === 0,
                "multi-tbody: second tbody resets to sectionRowIndex === 0 (got: " + si3B0.sectionRowIndex + ")");
        }
        if (si3B1) {
            assert(si3B1.sectionRowIndex === 1,
                "multi-tbody: second tbody row 1 has sectionRowIndex === 1 (got: " + si3B1.sectionRowIndex + ")");
        }
        if (si3B2) {
            assert(si3B2.sectionRowIndex === 2,
                "multi-tbody: second tbody row 2 has sectionRowIndex === 2 (got: " + si3B2.sectionRowIndex + ")");
        }

        // Single row in section
        var si4Only = document.getElementById('si4-only');
        if (si4Only) {
            assert(si4Only.sectionRowIndex === 0,
                "single row in thead has sectionRowIndex === 0 (got: " + si4Only.sectionRowIndex + ")");
        }

        info("Tests cover: direct table rows, thead/tbody/tfoot reset, multiple tbodies reset, single row in section");
    </script>

    <h2>Visual Tests - tr.insertCell() / tr.deleteCell() (WHATWG 4.9.8)</h2>

    <h3>Test: insertCell on existing row</h3>
    <div class="test-box">
        <table id="icT1">
            <tr id="ic1-row">
                <td>A</td>
                <td>B</td>
                <td>C</td>
            </tr>
        </table>
    </div>
    <p>Expected: Row with 3 cells to be modified by insertCell tests</p>

    <h3>Test: insertCell on empty row</h3>
    <div class="test-box">
        <table id="icT2">
            <tr id="ic2-empty"></tr>
        </table>
    </div>
    <p>Expected: Empty row, insertCell adds first cell</p>

    <h3>Test: deleteCell on existing row</h3>
    <div class="test-box">
        <table id="dcT1">
            <tr id="dc1-row">
                <td>X</td>
                <td>Y</td>
                <td>Z</td>
            </tr>
        </table>
    </div>
    <p>Expected: Row with 3 cells to be modified by deleteCell tests</p>

    <h3>Test: deleteCell(-1) on row</h3>
    <div class="test-box">
        <table id="dcT2">
            <tr id="dc2-row">
                <td>P</td>
                <td>Q</td>
                <td>R</td>
            </tr>
        </table>
    </div>
    <p>Expected: deleteCell(-1) removes last cell repeatedly</p>

    <h3>Test: insertCell on row with mixed th/td</h3>
    <div class="test-box">
        <table id="icT3">
            <tr id="ic3-mixed">
                <th>Header</th>
                <td>Data</td>
            </tr>
        </table>
    </div>
    <p>Expected: insertCell always creates td, even among th cells</p>

    <h2>JavaScript Tests - tr.insertCell() / tr.deleteCell() (WHATWG 4.9.8)</h2>
    <script>
        info("--- tr.insertCell() / tr.deleteCell() tests (WHATWG 4.9.8) ---");

        // === insertCell tests ===

        // insertCell() with no args appends at end
        var ic1Row = document.getElementById('ic1-row');
        if (ic1Row) {
            var before = ic1Row.cells.length;
            var newCell = ic1Row.insertCell();
            newCell.textContent = "D";
            assert(ic1Row.cells.length === before + 1,
                "insertCell() increases cells.length (was: " + before + ", now: " + ic1Row.cells.length + ")");
            assert(ic1Row.cells[ic1Row.cells.length - 1].textContent === "D",
                "insertCell() appends at end (last cell is 'D', got: '" + ic1Row.cells[ic1Row.cells.length - 1].textContent + "')");
        }

        // insertCell(-1) appends at end
        if (ic1Row) {
            var before = ic1Row.cells.length;
            var newCell = ic1Row.insertCell(-1);
            newCell.textContent = "E";
            assert(ic1Row.cells.length === before + 1,
                "insertCell(-1) increases cells.length (was: " + before + ", now: " + ic1Row.cells.length + ")");
            assert(ic1Row.cells[ic1Row.cells.length - 1].textContent === "E",
                "insertCell(-1) appends at end (last cell is 'E', got: '" + ic1Row.cells[ic1Row.cells.length - 1].textContent + "')");
        }

        // insertCell(0) inserts at beginning
        if (ic1Row) {
            var before = ic1Row.cells.length;
            var newCell = ic1Row.insertCell(0);
            newCell.textContent = "FIRST";
            assert(ic1Row.cells.length === before + 1,
                "insertCell(0) increases cells.length (was: " + before + ", now: " + ic1Row.cells.length + ")");
            assert(ic1Row.cells[0].textContent === "FIRST",
                "insertCell(0) inserts at beginning (cells[0] is 'FIRST', got: '" + ic1Row.cells[0].textContent + "')");
        }

        // insertCell returns a TD element
        if (ic1Row) {
            var newCell = ic1Row.insertCell();
            assert(newCell.tagName === "TD",
                "insertCell() returns element with tagName 'TD' (got: '" + newCell.tagName + "')");
        }

        // insertCell on empty row
        var ic2Empty = document.getElementById('ic2-empty');
        if (ic2Empty) {
            assert(ic2Empty.cells.length === 0,
                "empty row starts with 0 cells");
            var newCell = ic2Empty.insertCell();
            newCell.textContent = "First!";
            assert(ic2Empty.cells.length === 1,
                "insertCell on empty row gives cells.length === 1 (got: " + ic2Empty.cells.length + ")");
            assert(ic2Empty.cells[0].textContent === "First!",
                "insertCell on empty row: cells[0].textContent is 'First!' (got: '" + ic2Empty.cells[0].textContent + "')");
        }

        // insertCell(index) inserts before cell at that index
        if (ic2Empty) {
            var newCell = ic2Empty.insertCell(0);
            newCell.textContent = "Before";
            assert(ic2Empty.cells[0].textContent === "Before",
                "insertCell(0) on 1-cell row: new cell is at [0] (got: '" + ic2Empty.cells[0].textContent + "')");
            assert(ic2Empty.cells[1].textContent === "First!",
                "insertCell(0) on 1-cell row: old cell moved to [1] (got: '" + ic2Empty.cells[1].textContent + "')");
        }

        // insertCell among mixed th/td  always creates td
        var ic3Mixed = document.getElementById('ic3-mixed');
        if (ic3Mixed) {
            var newCell = ic3Mixed.insertCell(1);
            newCell.textContent = "Inserted";
            assert(newCell.tagName === "TD",
                "insertCell among th/td creates TD (got: '" + newCell.tagName + "')");
            assert(ic3Mixed.cells[1].textContent === "Inserted",
                "insertCell(1) in mixed row: cells[1] is 'Inserted' (got: '" + ic3Mixed.cells[1].textContent + "')");
            assert(ic3Mixed.cells.length === 3,
                "mixed row now has 3 cells (got: " + ic3Mixed.cells.length + ")");
        }

        // === deleteCell tests ===

        // deleteCell(0) removes first cell
        var dc1Row = document.getElementById('dc1-row');
        if (dc1Row) {
            assert(dc1Row.cells.length === 3,
                "deleteCell row starts with 3 cells");
            dc1Row.deleteCell(0);
            assert(dc1Row.cells.length === 2,
                "deleteCell(0) decreases cells.length to 2 (got: " + dc1Row.cells.length + ")");
            assert(dc1Row.cells[0].textContent === "Y",
                "deleteCell(0) removed 'X', first cell is now 'Y' (got: '" + dc1Row.cells[0].textContent + "')");
        }

        // deleteCell(index) removes cell at that index
        if (dc1Row) {
            dc1Row.deleteCell(1);
            assert(dc1Row.cells.length === 1,
                "deleteCell(1) decreases cells.length to 1 (got: " + dc1Row.cells.length + ")");
            assert(dc1Row.cells[0].textContent === "Y",
                "deleteCell(1) removed 'Z', remaining cell is 'Y' (got: '" + dc1Row.cells[0].textContent + "')");
        }

        // deleteCell(-1) removes last cell
        var dc2Row = document.getElementById('dc2-row');
        if (dc2Row) {
            assert(dc2Row.cells.length === 3,
                "deleteCell(-1) row starts with 3 cells");
            dc2Row.deleteCell(-1);
            assert(dc2Row.cells.length === 2,
                "deleteCell(-1) decreases cells.length to 2 (got: " + dc2Row.cells.length + ")");
            assert(dc2Row.cells[1].textContent === "Q",
                "deleteCell(-1) removed 'R', last cell is now 'Q' (got: '" + dc2Row.cells[1].textContent + "')");
        }

        // deleteCell(-1) again removes new last cell
        if (dc2Row) {
            dc2Row.deleteCell(-1);
            assert(dc2Row.cells.length === 1,
                "second deleteCell(-1) leaves 1 cell (got: " + dc2Row.cells.length + ")");
            assert(dc2Row.cells[0].textContent === "P",
                "remaining cell is 'P' (got: '" + dc2Row.cells[0].textContent + "')");
        }

        info("Tests cover: insertCell() no-arg, insertCell(-1), insertCell(0), insertCell(index), empty row, mixed th/td, deleteCell(0), deleteCell(index), deleteCell(-1), repeated deletion");
    </script>

    <h2>Visual Tests - colspan Layout Support</h2>

    <h3>Test: Basic colspan=2 in header row</h3>
    <div class="test-box">
        <table id="csT1" border="1">
            <tr>
                <th colspan="2">Name</th>
                <th>Age</th>
            </tr>
            <tr>
                <td>First</td>
                <td>Last</td>
                <td>30</td>
            </tr>
        </table>
    </div>
    <p>Expected: "Name" header spans 2 columns, aligning over "First" and "Last". Table has 3 logical columns.</p>

    <h3>Test: colspan=3 spanning full row</h3>
    <div class="test-box">
        <table id="csT2" border="1">
            <tr>
                <td>A</td>
                <td>B</td>
                <td>C</td>
            </tr>
            <tr>
                <td colspan="3">This cell spans all 3 columns</td>
            </tr>
        </table>
    </div>
    <p>Expected: Second row has one cell spanning the full table width (3 columns).</p>

    <h3>Test: Multiple colspans in same row</h3>
    <div class="test-box">
        <table id="csT3" border="1">
            <tr>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
            </tr>
            <tr>
                <td colspan="2">Spans 1-2</td>
                <td colspan="2">Spans 3-4</td>
            </tr>
        </table>
    </div>
    <p>Expected: Second row has 2 cells, each spanning 2 columns. 4 logical columns total.</p>

    <h3>Test: colspan with no-colspan rows mixed</h3>
    <div class="test-box">
        <table id="csT4" border="1">
            <tr>
                <td colspan="3">Title spanning all</td>
            </tr>
            <tr>
                <td>A</td>
                <td>B</td>
                <td>C</td>
            </tr>
            <tr>
                <td>D</td>
                <td colspan="2">E spans 2</td>
            </tr>
        </table>
    </div>
    <p>Expected: Row 1 spans all 3 cols. Row 2 has 3 normal cells. Row 3 has "D" (1 col) + "E spans 2" (2 cols).</p>

    <h3>Test: colspan=1 (explicit, same as default)</h3>
    <div class="test-box">
        <table id="csT5" border="1">
            <tr>
                <td colspan="1">A</td>
                <td colspan="1">B</td>
            </tr>
            <tr>
                <td>C</td>
                <td>D</td>
            </tr>
        </table>
    </div>
    <p>Expected: colspan=1 behaves identically to no colspan. Both rows look the same.</p>

    <h3>Test: Table inside thead/tbody with colspan</h3>
    <div class="test-box">
        <table id="csT6" border="1">
            <thead>
                <tr>
                    <th colspan="3">Report Header</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Q1</td>
                    <td>Q2</td>
                    <td>Q3</td>
                </tr>
                <tr>
                    <td>100</td>
                    <td>200</td>
                    <td>300</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td>Total</td>
                    <td colspan="2">600</td>
                </tr>
            </tfoot>
        </table>
    </div>
    <p>Expected: Header spans all 3 cols. Body has 3-col rows. Footer has "Total" (1 col) + "600" (2 cols).</p>

    <h2>Visual Tests - rowspan Layout Support</h2>

    <h3>Test: Basic rowspan=2</h3>
    <div class="test-box">
        <table id="rsT1" border="1">
            <tr>
                <td rowspan="2">Spans 2 rows</td>
                <td>B1</td>
                <td>C1</td>
            </tr>
            <tr>
                <td>B2</td>
                <td>C2</td>
            </tr>
        </table>
    </div>
    <p>Expected: First column cell spans both rows vertically. B1/C1 in row 1, B2/C2 in row 2. Table has 3 columns.</p>

    <h3>Test: rowspan=3 spanning all rows</h3>
    <div class="test-box">
        <table id="rsT2" border="1">
            <tr>
                <td>A</td>
                <td rowspan="3">Sidebar</td>
                <td>C1</td>
            </tr>
            <tr>
                <td>B</td>
                <td>C2</td>
            </tr>
            <tr>
                <td>C</td>
                <td>C3</td>
            </tr>
        </table>
    </div>
    <p>Expected: Middle column "Sidebar" spans all 3 rows. Left column has A/B/C, right column has C1/C2/C3.</p>

    <h3>Test: Multiple rowspan cells in same column</h3>
    <div class="test-box">
        <table id="rsT3" border="1">
            <tr>
                <td rowspan="2">Top pair</td>
                <td>B1</td>
            </tr>
            <tr>
                <td>B2</td>
            </tr>
            <tr>
                <td rowspan="2">Bottom pair</td>
                <td>B3</td>
            </tr>
            <tr>
                <td>B4</td>
            </tr>
        </table>
    </div>
    <p>Expected: Column 1 has two stacked rowspan cells: "Top pair" spans rows 1-2, "Bottom pair" spans rows 3-4.</p>

    <h3>Test: rowspan + colspan combined</h3>
    <div class="test-box">
        <table id="rsT4" border="1">
            <tr>
                <td rowspan="2" colspan="2">Big cell (2x2)</td>
                <td>C1</td>
            </tr>
            <tr>
                <td>C2</td>
            </tr>
            <tr>
                <td>A3</td>
                <td>B3</td>
                <td>C3</td>
            </tr>
        </table>
    </div>
    <p>Expected: "Big cell" occupies a 2-column x 2-row area in the top-left. C1 and C2 on the right. Row 3 has 3 normal cells.</p>

    <h3>Test: rowspan exceeding available rows (clamped)</h3>
    <div class="test-box">
        <table id="rsT5" border="1">
            <tr>
                <td rowspan="10">Claims 10 rows</td>
                <td>B1</td>
            </tr>
            <tr>
                <td>B2</td>
            </tr>
        </table>
    </div>
    <p>Expected: Left cell claims rowspan=10 but only 2 rows exist. It should span both rows and be clamped to the table height.</p>

    <h3>Test: rowspan=1 (explicit, same as default)</h3>
    <div class="test-box">
        <table id="rsT6" border="1">
            <tr>
                <td rowspan="1">A</td>
                <td rowspan="1">B</td>
            </tr>
            <tr>
                <td>C</td>
                <td>D</td>
            </tr>
        </table>
    </div>
    <p>Expected: rowspan=1 behaves identically to no rowspan. Both rows look the same as a normal table.</p>

    <h3>Test: rowspan within thead/tbody/tfoot</h3>
    <div class="test-box">
        <table id="rsT7" border="1">
            <thead>
                <tr>
                    <th rowspan="2">Category</th>
                    <th>Q1</th>
                    <th>Q2</th>
                </tr>
                <tr>
                    <th>Jan-Mar</th>
                    <th>Apr-Jun</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="2">Sales</td>
                    <td>100</td>
                    <td>200</td>
                </tr>
                <tr>
                    <td>150</td>
                    <td>250</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: "Category" spans 2 header rows. "Sales" spans 2 body rows. Each rowspan cell is left-aligned in column 1.</p>

    <h3>Test: Row with all columns occupied by rowspan</h3>
    <div class="test-box">
        <table id="rsT8" border="1">
            <tr>
                <td rowspan="2">A</td>
                <td rowspan="2">B</td>
                <td rowspan="2">C</td>
            </tr>
            <tr>
                <!-- all columns occupied by rowspans above -->
            </tr>
            <tr>
                <td>D</td>
                <td>E</td>
                <td>F</td>
            </tr>
        </table>
    </div>
    <p>Expected: Row 1 has A/B/C all spanning into row 2. Row 2 has no explicit cells (all occupied). Row 3 has D/E/F.</p>

    <h2>Visual Tests - CSS width on Table Cells</h2>

    <h3>Test: Explicit pixel width on td</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td style="width: 200px;">200px wide</td>
                <td>Auto</td>
                <td>Auto</td>
            </tr>
            <tr>
                <td>Row 2 Col 1</td>
                <td>Row 2 Col 2</td>
                <td>Row 2 Col 3</td>
            </tr>
        </table>
    </div>
    <p>Expected: First column is 200px wide. Remaining columns share the leftover space equally.</p>

    <h3>Test: Explicit pixel width on th</h3>
    <div class="test-box">
        <table border="1">
            <thead>
                <tr>
                    <th style="width: 150px;">Name (150px)</th>
                    <th style="width: 300px;">Description (300px)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>A useful widget for things</td>
                    <td>Edit</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: "Name" column is 150px, "Description" column is 300px, "Actions" gets remaining space.</p>

    <h3>Test: All cells with explicit width</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td style="width: 100px;">100px</td>
                <td style="width: 200px;">200px</td>
                <td style="width: 150px;">150px</td>
            </tr>
            <tr>
                <td>A</td>
                <td>B</td>
                <td>C</td>
            </tr>
        </table>
    </div>
    <p>Expected: Columns are 100px, 200px, and 150px wide respectively.</p>

    <h3>Test: Width on one row affects entire column</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>No width set</td>
                <td>No width set</td>
            </tr>
            <tr>
                <td style="width: 250px;">250px (set here)</td>
                <td>Auto</td>
            </tr>
            <tr>
                <td>Inherits column width</td>
                <td>Inherits column width</td>
            </tr>
        </table>
    </div>
    <p>Expected: First column is 250px wide across ALL rows, even though width is only set on row 2.</p>

    <h3>Test: Percentage width on td</h3>
    <div class="test-box">
        <table border="1" style="width: 600px;">
            <tr>
                <td style="width: 25%;">25%</td>
                <td style="width: 50%;">50%</td>
                <td style="width: 25%;">25%</td>
            </tr>
            <tr>
                <td>A</td>
                <td>B</td>
                <td>C</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table is 600px wide. Columns are 150px (25%), 300px (50%), 150px (25%).</p>

    <h3>Test: Mixed pixel and auto widths</h3>
    <div class="test-box">
        <table border="1" style="width: 500px;">
            <tr>
                <td style="width: 100px;">100px fixed</td>
                <td>Auto (fills remaining)</td>
            </tr>
            <tr>
                <td>Row 2 Col 1</td>
                <td>Row 2 Col 2</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table is 500px. First column is 100px, second column fills the remaining 400px.</p>

    <h3>Test: Width with colspan</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td style="width: 120px;">120px</td>
                <td style="width: 120px;">120px</td>
                <td style="width: 120px;">120px</td>
            </tr>
            <tr>
                <td colspan="2">Spans 2 cols (should be 240px)</td>
                <td>120px</td>
            </tr>
        </table>
    </div>
    <p>Expected: Three 120px columns. Second row first cell spans 2 columns (240px total).</p>

    <h3>Test: Table width attribute (percent)</h3>
    <div class="test-box">
        <table id="test9" width="85%" style="background-color: #f0f7ff;">
            <tr>
                <td>Wide A</td>
                <td>Wide B</td>
            </tr>
        </table>
    </div>
    <p>Expected: Table width is 85% of the test box container</p>

    <h2>Visual Tests - vertical-align in Table Cells</h2>

    <h3>Test: CSS vertical-align top (default)</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td style="vertical-align: top;">Top<br>aligned<br>cell</td>
                <td style="vertical-align: top;">Short</td>
                <td style="vertical-align: top;">Also<br>top</td>
            </tr>
        </table>
    </div>
    <p>Expected: All cells top-aligned. "Short" and "Also top" content hugs the top edge of the row.</p>

    <h3>Test: CSS vertical-align middle</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>Tall cell<br>with extra<br>lines<br>to push height</td>
                <td style="vertical-align: middle;">Middle</td>
                <td style="vertical-align: middle;">Also<br>middle</td>
            </tr>
        </table>
    </div>
    <p>Expected: Left cell sets the row height. "Middle" and "Also middle" are vertically centered within the tall row.</p>

    <h3>Test: CSS vertical-align bottom</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>Tall cell<br>with extra<br>lines<br>to push height</td>
                <td style="vertical-align: bottom;">Bottom</td>
                <td style="vertical-align: bottom;">Also<br>bottom</td>
            </tr>
        </table>
    </div>
    <p>Expected: Left cell sets the row height. "Bottom" and "Also bottom" content hugs the bottom edge of the row.</p>

    <h3>Test: HTML valign attribute - top</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>Tall cell<br>with extra<br>lines<br>to push height</td>
                <td valign="top">valign top</td>
            </tr>
        </table>
    </div>
    <p>Expected: "valign top" content is at the top of the row, same as CSS vertical-align: top.</p>

    <h3>Test: HTML valign attribute - middle</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>Tall cell<br>with extra<br>lines<br>to push height</td>
                <td valign="middle">valign middle</td>
            </tr>
        </table>
    </div>
    <p>Expected: "valign middle" content is vertically centered in the row.</p>

    <h3>Test: HTML valign attribute - bottom</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>Tall cell<br>with extra<br>lines<br>to push height</td>
                <td valign="bottom">valign bottom</td>
            </tr>
        </table>
    </div>
    <p>Expected: "valign bottom" content is at the bottom of the row.</p>

    <h3>Test: Mixed vertical-align in same row</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td style="vertical-align: top;">Top</td>
                <td>Tall<br>reference<br>cell<br>sets height</td>
                <td style="vertical-align: middle;">Middle</td>
                <td style="vertical-align: bottom;">Bottom</td>
            </tr>
        </table>
    </div>
    <p>Expected: Four cells in one row  "Top" at top, tall cell sets height, "Middle" centered, "Bottom" at bottom.</p>

    <h3>Test: CSS vertical-align overrides valign attribute</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>Tall cell<br>with extra<br>lines<br>to push height</td>
                <td valign="top" style="vertical-align: bottom;">CSS wins (bottom)</td>
            </tr>
        </table>
    </div>
    <p>Expected: Inline CSS overrides the valign attribute. Content should be at the bottom, not the top.</p>

    <h2>Visual Tests - &lt;colgroup&gt; / &lt;col&gt; Width Support</h2>

    <h3>Test: col with pixel width attribute</h3>
    <div class="test-box">
        <table border="1">
            <colgroup>
                <col width="100">
                <col width="250">
                <col width="150">
            </colgroup>
            <tr>
                <td>100px</td>
                <td>250px</td>
                <td>150px</td>
            </tr>
            <tr>
                <td>Row 2</td>
                <td>Row 2</td>
                <td>Row 2</td>
            </tr>
        </table>
    </div>
    <p>Expected: Columns are 100px, 250px, and 150px wide respectively, driven by the &lt;col width&gt; attributes.</p>

    <h3>Test: col with CSS style width</h3>
    <div class="test-box">
        <table border="1">
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 100px;">
                <col>
            </colgroup>
            <tr>
                <td>200px (CSS)</td>
                <td>100px (CSS)</td>
                <td>Auto</td>
            </tr>
        </table>
    </div>
    <p>Expected: First column 200px, second 100px via inline CSS on &lt;col&gt;, third takes remaining space.</p>

    <h3>Test: col with span attribute</h3>
    <div class="test-box">
        <table border="1">
            <colgroup>
                <col width="80">
                <col span="2" width="200">
                <col width="80">
            </colgroup>
            <tr>
                <td>80px</td>
                <td>200px</td>
                <td>200px</td>
                <td>80px</td>
            </tr>
        </table>
    </div>
    <p>Expected: 4 columns. Col 1 and 4 are 80px. Cols 2 and 3 are 200px each  set by a single &lt;col span="2"&gt;.</p>

    <h3>Test: colgroup with no col children (colgroup span)</h3>
    <div class="test-box">
        <table border="1">
            <colgroup span="2" width="150">
            </colgroup>
            <colgroup>
                <col width="250">
            </colgroup>
            <tr>
                <td>150px</td>
                <td>150px</td>
                <td>250px</td>
            </tr>
        </table>
    </div>
    <p>Expected: First two columns are 150px (set by colgroup span=2). Third is 250px.</p>

    <h3>Test: cell width overrides col width</h3>
    <div class="test-box">
        <table border="1">
            <colgroup>
                <col width="80">
                <col width="80">
                <col width="80">
            </colgroup>
            <tr>
                <td>80px (col)</td>
                <td style="width: 300px;">300px (cell wins)</td>
                <td>80px (col)</td>
            </tr>
        </table>
    </div>
    <p>Expected: Col sets 80px for all columns, but the middle cell's explicit 300px style overrides it.</p>

    <h3>Test: col width with auto fallback</h3>
    <div class="test-box">
        <table border="1">
            <colgroup>
                <col width="200">
                <col>
                <col>
            </colgroup>
            <tr>
                <td>200px (col)</td>
                <td>Auto</td>
                <td>Auto</td>
            </tr>
        </table>
    </div>
    <p>Expected: First column 200px from col. The other two share the remaining space equally (auto).</p>

    <h2>Visual Tests - cellspacing attribute</h2>

    <h3>Test: Default spacing (no attribute)</h3>
    <div class="test-box">
        <table border="1">
            <tr><td>A</td><td>B</td><td>C</td></tr>
            <tr><td>D</td><td>E</td><td>F</td></tr>
        </table>
    </div>
    <p>Expected: No gap between cells (borders touch)</p>

    <h3>Test: cellspacing="0"</h3>
    <div class="test-box">
        <table border="1" cellspacing="0">
            <tr><td>A</td><td>B</td><td>C</td></tr>
            <tr><td>D</td><td>E</td><td>F</td></tr>
        </table>
    </div>
    <p>Expected: Same as default  no gap between cells</p>

    <h3>Test: cellspacing="6"</h3>
    <div class="test-box">
        <table border="1" cellspacing="6">
            <tr><td>A</td><td>B</td><td>C</td></tr>
            <tr><td>D</td><td>E</td><td>F</td></tr>
        </table>
    </div>
    <p>Expected: 6px gap between all cells horizontally and vertically</p>

    <h3>Test: cellspacing="16"</h3>
    <div class="test-box">
        <table border="1" cellspacing="16">
            <tr><td>A</td><td>B</td><td>C</td></tr>
            <tr><td>D</td><td>E</td><td>F</td></tr>
        </table>
    </div>
    <p>Expected: Large gap between cells  clearly wider than cellspacing=6</p>

    <h2>Visual Tests - cellpadding attribute</h2>

    <h3>Test: Default padding (no attribute)</h3>
    <div class="test-box">
        <table border="1">
            <tr>
                <td>Default</td>
                <td>Padding</td>
            </tr>
        </table>
    </div>
    <p>Expected: Cells with 8px padding (default)</p>

    <h3>Test: cellpadding="0"  no padding</h3>
    <div class="test-box">
        <table border="1" cellpadding="0">
            <tr>
                <td>Zero</td>
                <td>Padding</td>
            </tr>
        </table>
    </div>
    <p>Expected: Text sits flush against cell borders, no inner spacing</p>

    <h3>Test: cellpadding="4"  reduced padding</h3>
    <div class="test-box">
        <table border="1" cellpadding="4">
            <tr>
                <td>Small</td>
                <td>Padding</td>
            </tr>
        </table>
    </div>
    <p>Expected: Cells with 4px padding  visibly tighter than the default</p>

    <h3>Test: cellpadding="16"  generous padding</h3>
    <div class="test-box">
        <table border="1" cellpadding="16">
            <tr>
                <td>Large</td>
                <td>Padding</td>
            </tr>
        </table>
    </div>
    <p>Expected: Cells with 16px padding  noticeably more spacious than the default</p>

    <h3>Test: cellpadding with multirow table</h3>
    <div class="test-box">
        <table border="1" cellpadding="12">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Widget</td>
                    <td>$5.00</td>
                </tr>
                <tr>
                    <td>Gadget</td>
                    <td>$8.00</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: All cells (th and td) have 12px padding uniformly applied</p>

    <!-- ============================================ -->
    <!-- td.headers tests (WHATWG 4.9.11)             -->
    <!-- ============================================ -->
    <hr>
    <h2>Visual Tests - HTMLTableCellElement.headers (WHATWG 4.9.11)</h2>

    <h3>Test: td with single header reference</h3>
    <div class="test-box">
        <table id="hdr-1">
            <tr>
                <th id="hdr-name">Name</th>
                <th id="hdr-dept">Department</th>
            </tr>
            <tr>
                <td id="hdr-a" headers="hdr-name">Alice</td>
                <td id="hdr-b" headers="hdr-dept">Engineering</td>
            </tr>
        </table>
    </div>
    <p>Expected: Each td references one th by id via the headers attribute</p>

    <h3>Test: td with multiple header references</h3>
    <div class="test-box">
        <table id="hdr-2">
            <tr>
                <th id="hdr-q">Quarter</th>
                <th id="hdr-r">Region</th>
                <th id="hdr-t">Total</th>
            </tr>
            <tr>
                <td id="hdr-multi" headers="hdr-q hdr-r hdr-t">$42,000</td>
            </tr>
        </table>
    </div>
    <p>Expected: td references three th ids (space-separated list in headers attribute)</p>

    <h3>Test: td with no headers attribute</h3>
    <div class="test-box">
        <table id="hdr-3">
            <tr>
                <td id="hdr-none">No headers attr</td>
            </tr>
        </table>
    </div>
    <p>Expected: td has no headers attribute  getter returns empty string ""</p>

    <h3>Test: th with headers attribute (applies to th too)</h3>
    <div class="test-box">
        <table id="hdr-4">
            <tr>
                <th id="hdr-col-group">Q1 Sales</th>
            </tr>
            <tr>
                <th id="hdr-sub" headers="hdr-col-group">Jan</th>
            </tr>
        </table>
    </div>
    <p>Expected: headers attribute works on th elements, not just td</p>

    <h2>JavaScript Tests - HTMLTableCellElement.headers (WHATWG 4.9.11)</h2>
    <script>
        info("--- td.headers property tests (WHATWG 4.9.11) ---");

        var hdrA    = document.getElementById("hdr-a");
        var hdrB    = document.getElementById("hdr-b");
        var hdrMulti = document.getElementById("hdr-multi");
        var hdrNone = document.getElementById("hdr-none");
        var hdrSub  = document.getElementById("hdr-sub");

        // headers getter returns the attribute string for single reference
        if (hdrA) {
            assert(hdrA.headers === "hdr-name",
                "td.headers returns single id (got: '" + hdrA.headers + "')");
        }

        // headers getter returns full space-separated string for multiple references
        if (hdrMulti) {
            assert(hdrMulti.headers === "hdr-q hdr-r hdr-t",
                "td.headers returns space-separated ids (got: '" + hdrMulti.headers + "')");
        }

        // headers getter returns "" when no attribute present
        if (hdrNone) {
            assert(hdrNone.headers === "",
                "td.headers returns '' when no attribute (got: '" + hdrNone.headers + "')");
        }

        // headers is a string type
        if (hdrA) {
            assert(typeof hdrA.headers === "string",
                "td.headers is typeof string (got: " + typeof hdrA.headers + ")");
        }

        // headers setter updates the attribute
        if (hdrB) {
            hdrB.headers = "hdr-name hdr-dept";
            assert(hdrB.headers === "hdr-name hdr-dept",
                "td.headers setter updates value (got: '" + hdrB.headers + "')");
            assert(hdrB.getAttribute("headers") === "hdr-name hdr-dept",
                "td.headers setter reflects to attribute (got: '" + hdrB.getAttribute("headers") + "')");
        }

        // headers setter with empty string clears the attribute
        if (hdrA) {
            hdrA.headers = "";
            assert(hdrA.headers === "",
                "td.headers setter can clear to empty string (got: '" + hdrA.headers + "')");
        }

        // headers works on th elements too
        if (hdrSub) {
            assert(hdrSub.headers === "hdr-col-group",
                "th.headers getter works (got: '" + hdrSub.headers + "')");
        }

        info("Tests cover: headers getter (single, multiple, absent), type check, setter (update, clear), th element");
    </script>

    <!-- ============================================ -->
    <!-- th.scope tests (WHATWG 4.9.11)               -->
    <!-- ============================================ -->
    <hr>
    <h2>Visual Tests - HTMLTableCellElement.scope (WHATWG 4.9.11)</h2>

    <h3>Test: th with scope="col"</h3>
    <div class="test-box">
        <table id="sc-1">
            <tr>
                <th id="sc-col1" scope="col">Name</th>
                <th id="sc-col2" scope="col">Age</th>
            </tr>
            <tr>
                <td>Alice</td>
                <td>30</td>
            </tr>
        </table>
    </div>
    <p>Expected: Column headers  each th declares it is a header for its column</p>

    <h3>Test: th with scope="row"</h3>
    <div class="test-box">
        <table id="sc-2">
            <tr>
                <th id="sc-row1" scope="row">Alice</th>
                <td>30</td>
                <td>Engineering</td>
            </tr>
            <tr>
                <th id="sc-row2" scope="row">Bob</th>
                <td>25</td>
                <td>Design</td>
            </tr>
        </table>
    </div>
    <p>Expected: Row headers  each th declares it is a header for its row</p>

    <h3>Test: th with scope="colgroup"</h3>
    <div class="test-box">
        <table id="sc-3">
            <colgroup><col><col></colgroup>
            <colgroup><col><col></colgroup>
            <tr>
                <th id="sc-cg1" scope="colgroup" colspan="2">Q1</th>
                <th id="sc-cg2" scope="colgroup" colspan="2">Q2</th>
            </tr>
            <tr>
                <td>Jan</td><td>Feb</td>
                <td>Apr</td><td>May</td>
            </tr>
        </table>
    </div>
    <p>Expected: Group headers  each th spans and labels a column group</p>

    <h3>Test: th with scope="rowgroup"</h3>
    <div class="test-box">
        <table id="sc-4">
            <tbody>
                <tr>
                    <th id="sc-rg1" scope="rowgroup" rowspan="2">North</th>
                    <td>Oslo</td>
                </tr>
                <tr>
                    <td>Stockholm</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>Expected: Row group header  th spans rows and labels the group</p>

    <h3>Test: th with no scope attribute</h3>
    <div class="test-box">
        <table id="sc-5">
            <tr>
                <th id="sc-none">No scope</th>
                <td>Value</td>
            </tr>
        </table>
    </div>
    <p>Expected: th with no scope attribute  getter returns "" (auto)</p>

    <h3>Test: td with scope attribute (invalid per spec, th only)</h3>
    <div class="test-box">
        <table id="sc-6">
            <tr>
                <td id="sc-td" scope="col">Data cell with scope</td>
            </tr>
        </table>
    </div>
    <p>Expected: td.scope reads the attribute (scope is on HTMLTableCellElement, both td and th)</p>

    <h2>JavaScript Tests - HTMLTableCellElement.scope (WHATWG 4.9.11)</h2>
    <script>
        info("--- th.scope property tests (WHATWG 4.9.11) ---");

        var scCol1  = document.getElementById("sc-col1");
        var scCol2  = document.getElementById("sc-col2");
        var scRow1  = document.getElementById("sc-row1");
        var scCg1   = document.getElementById("sc-cg1");
        var scRg1   = document.getElementById("sc-rg1");
        var scNone  = document.getElementById("sc-none");
        var scTd    = document.getElementById("sc-td");

        // scope getter returns "col"
        if (scCol1) {
            assert(scCol1.scope === "col",
                "th.scope returns 'col' (got: '" + scCol1.scope + "')");
        }

        // scope getter returns "row"
        if (scRow1) {
            assert(scRow1.scope === "row",
                "th.scope returns 'row' (got: '" + scRow1.scope + "')");
        }

        // scope getter returns "colgroup"
        if (scCg1) {
            assert(scCg1.scope === "colgroup",
                "th.scope returns 'colgroup' (got: '" + scCg1.scope + "')");
        }

        // scope getter returns "rowgroup"
        if (scRg1) {
            assert(scRg1.scope === "rowgroup",
                "th.scope returns 'rowgroup' (got: '" + scRg1.scope + "')");
        }

        // scope returns "" when no attribute (missing value default = auto = "")
        if (scNone) {
            assert(scNone.scope === "",
                "th.scope returns '' when no attribute (got: '" + scNone.scope + "')");
        }

        // scope is a string
        if (scCol1) {
            assert(typeof scCol1.scope === "string",
                "th.scope is typeof string (got: " + typeof scCol1.scope + ")");
        }

        // scope setter updates the value
        if (scCol2) {
            scCol2.scope = "colgroup";
            assert(scCol2.scope === "colgroup",
                "th.scope setter updates to 'colgroup' (got: '" + scCol2.scope + "')");
            assert(scCol2.getAttribute("scope") === "colgroup",
                "th.scope setter reflects to attribute (got: '" + scCol2.getAttribute("scope") + "')");
        }

        // scope getter returns "" for invalid values (limited to known values per spec)
        if (scCol2) {
            scCol2.scope = "invalid-value";
            assert(scCol2.scope === "",
                "th.scope returns '' for invalid attribute value (got: '" + scCol2.scope + "')");
        }

        // scope setter with "" clears to auto state
        if (scRow1) {
            scRow1.scope = "";
            assert(scRow1.scope === "",
                "th.scope setter with '' results in '' (got: '" + scRow1.scope + "')");
        }

        // scope works on td elements too (HTMLTableCellElement covers both)
        if (scTd) {
            assert(scTd.scope === "col",
                "td.scope reads attribute value (got: '" + scTd.scope + "')");
        }

        info("Tests cover: scope getter (col, row, colgroup, rowgroup, absent), type check, setter, invalid value  '', td element");
    </script>

    <hr>
    <p><a href="index.html">Back to Index</a></p>
</body>
</html>
